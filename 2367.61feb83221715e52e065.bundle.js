(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[2367],{32367:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Q});var o=n(51173);const i=({REPL:e})=>e.qexec("tab close"),s=e=>({command:e,strict:e,docs:"Quit the program"}),a=e=>{(0,o.inBrowser)()||(e.listen("/quit",i,{usage:s("quit")}),e.listen("/window/close",(()=>(n(58933).remote.getCurrentWindow().close(),!0)))),e.listen("/exit",i,{usage:s("exit")})},r=({tab:e})=>((0,o.isHeadless)()||setTimeout((()=>{o.eventChannelUnsafe.emit(`/terminal/clear/${(0,o.getTabId)(e)}`),o.eventChannelUnsafe.emit(`/close/views/${(0,o.getTabId)(e)}`)})),!0),c=e=>{e.listen("/clear",r)};var l=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};function d(e){return l(this,void 0,void 0,(function*(){const{N:t=10}=e.parsedOptions,n=e.command.replace(/-N\s+\d+/g,""),o=n.substring(n.indexOf("dopar ")+"dopar ".length);return yield Promise.all(Array(t).fill(0).map((()=>e.REPL.qexec(o)))),!0}))}var u=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};function p(e){e.listen("/watch",(e=>u(this,void 0,void 0,(function*(){const t=e.command.slice(e.argvNoOptions[0].length+1),n=yield e.REPL.qexec(t),o=e.parsedOptions.n||e.parsedOptions.interval||2e3,i=setTimeout((()=>u(this,void 0,void 0,(function*(){yield e.REPL.reexec(e.command,{execUUID:e.execOptions.execUUID})}))),o);return{response:n,abort:()=>{clearTimeout(i)}}}))),{flags:{boolean:["t","no-title"]}})}var m=n(11227),f=n.n(m),h=n(48764).Buffer;const g=f()("plugins/core-support/base64"),v={command:"base64",strict:"base64",hidden:!0,required:[{name:"string",docs:"The string to encode or decode"}],optional:[{name:"--decode",alias:"-d",boolean:!0,docs:"Decode the given string"},{name:"--break",alias:"-b",numeric:!0,docs:"break encoded string into num character lines"}]},w=(e,t)=>{if(t.break>0){let n="";for(let o=0;o<e.length;o+=t.break)n=n+e.slice(o,Math.min(e.length,o+t.break))+"\n";return n}return e},b=e=>{g("init"),e.listen("/base64",(({argvNoOptions:e,parsedOptions:t})=>{const n=e[1];return g("str",n,e),t.decode?(g("decoding"),w(h.from(n,"base64").toString(),t)):(g("encoding"),w(h.from(n).toString("base64"),t))}),{usage:v})},y={command:"prompt",strict:"prompt",hidden:!0,optional:[{name:"promptString",positional:!0,docs:"The prompt string"}]},x=e=>{e.listen("/prompt",(()=>{throw new Error("Unsupported at the moment")}),{usage:y})};var O=n(48764).Buffer,k=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};const q=[{name:"<filepath>",docs:"path to saved snapshot"}],N={usage:{strict:"replay",required:q,optional:[{name:"--freshen",alias:"-f",boolean:!0,docs:"Regenerate snapshot"},{name:"--new-window",alias:"-w",boolean:!0,docs:"Replay in a new window (Electron only)"},{name:"--close-current-tab",alias:"-c",boolean:!0,docs:"Also close the current tab"},{name:"--status-stripe",docs:"Modify status stripe",allowed:["default","blue","yellow","red"]}]},flags:{boolean:["new-window","w","freshen","f","close-current-tab","c"]}},P={usage:{strict:"snapshot",required:q,optional:[{name:"--shallow",alias:"-s",boolean:!0,docs:"Do not record click events"},{name:"--description",alias:"-d",docs:"Description for this snapshot"},{name:"--exec",alias:"-x",docs:"Prefer to re-execute commands when replay"},{name:"--title",alias:"-t",docs:"Title for this snapshot"}]},flags:{boolean:["--shallow","-s"]}};function I(e){e.listen("/replay",(({argvNoOptions:e,parsedOptions:t,REPL:n})=>k(this,void 0,void 0,(function*(){const i=(0,o.expandHomeDir)(e[1]),s=yield function(e,t){return k(this,void 0,void 0,(function*(){return JSON.parse((yield e.rexec(`vfs fstat ${e.encodeComponent(t)} --with-data`)).content.data)}))}(n,i);if((0,o.isNotebook)(s)){const e=`**Now Playing**: ${s.metadata.name||"a snapshot"}`,a=s.metadata.name?`--title "${s.metadata.name}"`:"";return t["new-window"]&&(0,o.inElectron)()?n.qexec(`replay-electron ${i}`):((t["close-current-tab"]||t.c)&&(yield n.qexec("tab close")),n.qexec(`tab new --snapshot "${i}" --quiet --status-stripe-type ${t["status-stripe"]||"blue"} ${a}`,void 0,void 0,{data:{"status-stripe-message":e}}))}throw console.error("invalid notebook",s),new Error("Invalid notebook")}))),N),e.listen("/snapshot",(({argvNoOptions:e,parsedOptions:t,REPL:n,tab:i})=>new Promise(((s,a)=>{const r={},c=(0,o.getPrimaryTabId)(i);o.eventBus.emitSnapshotRequest({filter:e=>{if(!r[e.execUUID])return r[e.execUUID]=!0,!0},cb:t=>k(this,void 0,void 0,(function*(){try{const i=(0,o.expandHomeDir)(e[e.indexOf("snapshot")+1]);yield n.rexec(`fwrite ${n.encodeComponent(i)}`,{data:O.from(t).toString()}),s(!0)}catch(e){a(e)}})),opts:{name:t.t||t.title,description:t.d||t.description,preferReExecute:t.exec||t.x,shallow:t.shallow}},c)}))),P)}const C={command:"sleep",strict:"sleep",required:[{name:"sleepTime",number:!0,docs:"The number of seconds to sleep"}]},E=e=>{e.listen("/sleep",(({argvNoOptions:e})=>new Promise((t=>{const n=parseInt(e[1],10);setTimeout((()=>t("")),1e3*n)}))),{usage:C})};var S=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};const T=f()("plugins/core-support/history"),R={history:{command:"history",strict:"history",docs:"List current command history, optionally filtering by a given string",example:"history 100 filterString",optional:[{name:"N",positional:!0,docs:"list the most recent N commands"},{name:"filterString",positional:!0,docs:"filter command history"},{name:"--clear",alias:"-c",docs:"clear your command history"}]},again:e=>({command:e,strict:e,docs:"Re-execute a given command index",example:`${e} 50`,optional:[{name:"N",positional:!0,docs:"re-execute the given history index N"}]})},D=({tab:e,argv:t,parsedOptions:n})=>S(void 0,void 0,void 0,(function*(){const i=yield(0,o.History)(e);if(n.c)return T("clearing command history"),i.wipe();const s=t.indexOf("history"),a=t.length-s-1,r=(e=>{try{return parseInt(e,10)}catch(e){}})(t[s+1]),c=2===a||r?s+1:-1,l=c>0?r:20,d=2===a?s+2:r?-1:s+1,u=d>0&&t[d],p=u?e=>e.raw.indexOf(u)>=0:()=>!0,m=Math.max(0,i.cursor-l-1),f=i.cursor-1,h=i.slice(m,f);T("argv",t),T("Nargs",a),T("Nidx",c),T("N",l),T("filterIdx",d),T("filterStr",u),T("got",h.length,m,f);const g=h.map(((e,t)=>{if(!p(e))return;const n=e.raw.substring(0,e.raw.indexOf(" ="))||e.raw,i=n.indexOf(" "),s=document.createElement("strong"),a=document.createElement("span");return s.innerText=n.substring(0,-1===i?n.length:i),-1!==i&&(a.innerText=n.substring(i)),new o.Row({attributes:[{key:"N",value:`${m+t}`}],fullName:e.raw,name:e.raw,onclick:e.raw})})).filter((e=>e));return new o.Table({noSort:!0,body:g})})),$=e=>{T("init"),e.listen("/history",D,{usage:R.history});const t=()=>e=>S(void 0,void 0,void 0,(function*(){const t=yield(0,o.History)(e.tab),n=e.argv[1]?parseInt(e.argv[1],10):t.cursor-2;return T("againCmd",e.execOptions),(({tab:e,REPL:t},n,i)=>S(void 0,void 0,void 0,(function*(){T("again",n,i);const s=yield(0,o.History)(e);if(s.line(n))return s.update(i,(e=>{e.raw=s.line(n).raw})),t.qexec(s.line(n).raw);throw new Error("Could not find the command to re-execute")})))(e,n,e.execOptions&&e.execOptions.history)})),n=e.listen("/!!",t(),{usage:R.again("!!")});e.synonym("/again",t(),n,{usage:R.again("again")})},U="kui-shell/v1/kui-config";function L(){const e=localStorage.getItem(U);return e?JSON.parse(e):{}}function B(e){localStorage.setItem(U,JSON.stringify(e))}function H(e){e.listen("/kuiconfig/set",(e=>(function(e,t){B(Object.assign(L(),{[e]:t}))}(e.argvNoOptions[2],e.argvNoOptions[3]||"true"),!0))),e.listen("/kuiconfig/get",(e=>{const t=e.argvNoOptions[2];return L()[t]||""})),e.listen("/kuiconfig/unset",(e=>(function(e){const t=L();delete t[e],B(t)}(e.argvNoOptions[2]),!0))),e.listen("/kuiconfig/is/set",(e=>{const t=e.argvNoOptions[3];return void 0!==L()[t]})),e.listen("/kuiconfig/not/set",(e=>{const t=e.argvNoOptions[3];return void 0===L()[t]}))}var A=n(48764).Buffer,J=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};const M=(0,o.i18n)("plugin-core-support"),j={strict:"switch",command:"switch",required:[{name:"tabIndex",numeric:!0,docs:"Switch to the given tab index"}]};function W(e){e.listen("/tab/switch",(({argvNoOptions:e})=>{const t=parseInt(e[e.length-1],10);return o.eventBus.emit("/tab/switch/request",t-1),!0}),{usage:j}),e.listen("/tab/new",(e=>J(this,void 0,void 0,(function*(){if(e.parsedOptions.if){if(!(yield e.REPL.qexec(e.parsedOptions.if)))return!0}if(e.parsedOptions.ifnot){if(yield e.REPL.qexec(e.parsedOptions.ifnot))return!0}const t=e.parsedOptions["status-stripe-message"]||(e.execOptions.data?e.execOptions.data["status-stripe-message"]:void 0),n={type:e.parsedOptions["status-stripe-type"],message:t},i={content:e.parsedOptions.title?M("Created a new tab named X",e.parsedOptions.title):M("Created a new tab"),contentType:"text/markdown"},s=e.parsedOptions.snapshot||e.parsedOptions.s;if(s){const t=(0,o.expandHomeDir)(s),a=yield function(e,t){return J(this,void 0,void 0,(function*(){return A.from((yield e.rexec(`vfs fstat ${e.encodeComponent(t)} --with-data`)).content.data)}))}(e.REPL,t);return new Promise((t=>{o.eventBus.emit("/tab/new/request",{statusStripeDecoration:n,snapshot:a,title:e.parsedOptions.title,background:e.parsedOptions.bg,onClose:e.parsedOptions.onClose}),t(i)}))}return e.parsedOptions.cmdline?new Promise((t=>{o.eventBus.emit("/tab/new/request",{statusStripeDecoration:n,title:e.parsedOptions.title,background:e.parsedOptions.bg,cmdline:e.parsedOptions.cmdline,exec:e.parsedOptions.quiet?"qexec":"pexec",onClose:e.parsedOptions.onClose}),t(i)})):(o.eventBus.emit("/tab/new/request",{statusStripeDecoration:n,title:e.parsedOptions.title,background:e.parsedOptions.bg,onClose:e.parsedOptions.onClose}),i)}))),{usage:{optional:[{name:"--cmdline",alias:"-c",docs:"Invoke a command in the new tab"},{name:"--quiet",alias:"-q",boolean:!0,docs:"Execute the given command line quietly"},{name:"--bg",alias:"-b",boolean:!0,docs:"Create, but do not switch to this tab"},{name:"--snapshot",alias:"-s",docs:"Snapshot file to display in the new tab"},{name:"--status-stripe-type",docs:"Desired status stripe coloration",allowed:["default","blue"]},{name:"--status-stripe-message",docs:"Desired status stripe message"},{name:"--title",alias:"-t",docs:"Title to display in the UI"}]},flags:{boolean:["bg","b","quiet","q"]}}),e.listen("/tab/close",(({tab:e,parsedOptions:t})=>function(e,t){const n=t?(0,o.getPrimaryTabId)(e):e.uuid;return o.eventBus.emitWithTabId("/tab/close/request",n,e),!0}(e,t.A)),{flags:{boolean:["A"]}})}var _=function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function a(e){try{c(o.next(e))}catch(e){s(e)}}function r(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))};const Q=e=>_(void 0,void 0,void 0,(function*(){var t;yield Promise.all([(t=e,void t.listen("/kuiecho",(({argvNoOptions:e})=>e.slice(1).join(" ")||!0))),a(e),c(e),e.listen("/dopar",d),p(e),b(e),x(e),I(e),E(e),$(e),H(e),W(e)]),(0,o.isHeadless)()||(yield Promise.all([n.e(3324).then(n.bind(n,43324)).then((t=>t.plugin(e))),n.e(4050).then(n.bind(n,54050)).then((t=>t.plugin(e)))]))}))}}]);