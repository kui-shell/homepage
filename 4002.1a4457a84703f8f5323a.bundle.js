(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[4002],{53589:(e,t,i)=>{"use strict";i.d(t,{KX:()=>d,Ov:()=>h,iP:()=>l});var n=i(11227),r=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}d((n=n.apply(e,t||[])).next())}))};const s=i.n(n)()("plugins/wskflow/util"),o="Zoom 1:1",a="Zoom to Fit",d=e=>{const t=e.split(/[\n\r]/);return{nLines:t.length,maxLineLength:t.reduce(((e,t)=>Math.max(e,t.length)),0)}},h=(e,t,{ast:i,viewOptions:n,container:o})=>r(void 0,void 0,void 0,(function*(){s("wskflow",n);return t(e,i,o,void 0,void 0,void 0,n,!1)})),l=(e,{visibleWhenShowing:t="visualization"}={})=>{if(e&&e.register){const n=i(17187),r=new n.EventEmitter,s=new n.EventEmitter,d=e=>{r.emit("change",!1===e.applyAutoScale&&!e.customZoom),s.emit("change",!0===e.applyAutoScale&&!e.customZoom)};return e.register(d),[{mode:"zoom-one-to-one",label:o,balloon:"Use a fixed-size canvas",selected:e.is1to1(),visibleWhen:t,kind:"view",command:()=>{e.zoom1to1()}},{mode:"zoom-to-fit",label:a,balloon:"Use a zoom to fit canvas",selected:!e.is1to1(),visibleWhen:t,kind:"view",command:()=>{e.zoomToFit()}}]}return[]}},64002:(e,t,i)=>{"use strict";i.d(t,{Z:()=>b});var n=i(11227),r=i.n(n),s=i(51173),o=i(53589);function a(e){return"while"===e.type||"while_nosave"===e.type}function d(e){return"dowhile"===e.type||"dowhile_nosave"===e.type}function h(e){return"on"===e.type}var l=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}d((n=n.apply(e,t||[])).next())}))};const c=r()("plugins/wskflow/subtext");var p=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}d((n=n.apply(e,t||[])).next())}))};const u=r()("plugins/wskflow/fsm2graph");function g(e){return e.replace(/-components/g,"").replace(/__origin/g,"").replace(/__terminus/g,"")}class f{constructor(e){this.dummyCount=0,this.taskIndex=0,this.activations=e,e&&this.activations.sort(((e,t)=>e.start-t.start)),this.visited=void 0,this.graphData={id:"root",label:"root",children:[],edges:[]}}addDummy(e=[],t,i,n,r,s){const o="dummy_"+this.dummyCount;let a,d;if(this.dummyCount++,i.children.push(this.drawNodeNew(o,n.label||o,n.type||"Dummy",e,n)),e&&e.length>0){a=this.drawEdgeNew(e[0],o,i),d=a.targetPort,i.edges.push(a);for(let t=1;t<e.length;t++)i.edges.push(this.drawEdgeNew(e[t],o,i,void 0,r,void 0,d))}if(t&&t.length>0){a=this.drawEdgeNew(o,t[0],i),d=a.sourcePort,i.edges.push(a);for(let e=1;e<t.length;e++)i.edges.push(this.drawEdgeNew(o,t[e],i,void 0,s,d,void 0))}return o}drawNodeNew(e,t,i,n,r){const s={id:e,label:t,type:i,ports:[],value:r&&r.value,tooltip:r&&r.tooltip,tooltipHeader:r&&r.tooltipHeader,properties:{}};if(this.visited)if("Entry"===e)this.visited[e]=[0],s.visited=this.visited[e];else if("Exit"===e)Array.isArray(n)&&n.forEach((t=>{this.visited[t]&&(this.visited[e]=[this.activations.length-1])})),s.visited=this.visited[e];else{const t=g(e);this.visited[t]&&("action"===i&&this.visited[t].forEach(((e,i)=>{this.visited[t][i]++})),"retain"===i?(this.visited[t].length>=1&&e.endsWith("__origin")||2===this.visited[t].length&&e.endsWith("__terminus"))&&(s.visited=this.visited[t]):s.visited=this.visited[t])}if(this.visited&&(this.visited[e]||"Entry"===e)&&(s.visited=this.visited[e]||[0]),"try"!==i&&"handler"!==i&&(s.properties["de.cau.cs.kieler.portConstraints"]="FIXED_ORDER"),r&&r.leftToRight&&delete s.properties["de.cau.cs.kieler.portConstraints"],"Dummy"!==i&&"Exit"!==i&&n&&(s.layoutOptions={},Object.keys(n).forEach((e=>{s.properties[e]=n[e],s.layoutOptions[e]=n[e]}))),r&&r.leftToRight&&(s.properties={direction:"RIGHT","org.eclipse.elk.direction":"RIGHT"}),"action"===s.type)-1!==t.indexOf("|")?(s.name=t.substring(0,t.indexOf("|")),t=t.substring(t.indexOf("|")+1),s.label=t):s.name=t,-1!==t.lastIndexOf("/")&&t.lastIndexOf("/")<t.length-1&&(s.label=t.substring(t.lastIndexOf("/")+1)),s.height=20,s.label.length<40?s.width=5*s.label.length+10:(s.label=s.label.substring(0,40)+"...",s.width=210),this.actions&&(void 0===this.actions[s.name]&&(this.actions[s.name]=[]),this.actions[s.name].push(s.id)),s.taskIndex=this.taskIndex++;else if("function"===s.type){s.fullFunctionCode=t;const e=t,{nLines:i,maxLineLength:n}=(0,o.KX)(e);if(r.renderFunctionsInView){const t=5;s.width=Math.min(100,n*t),s.height=10*Math.max(2.25,i),s.multiLineLabel=e.split(/[\n\r]/).map((e=>{const i=s.width/t;return i>=e.length?e:e.substring(0,i)+"â€¦"})),s.prettyCode=e,delete s.label}else s.width=8,s.height=8,s.tooltip=e,delete s.label;s.taskIndex=this.taskIndex++}else"try_catch"===s.type?(s.properties={direction:"RIGHT","org.eclipse.elk.direction":"RIGHT"},s.children=[{id:`${e}-body`,label:"try",type:"try",ports:[],properties:{},children:[],edges:[],visited:this.visited?this.visited[g(`${e}-body`)]:void 0},{id:`${e}-handler`,label:"error handler",type:"handler",ports:[],properties:{},children:[],edges:[],visited:this.visited?this.visited[g(`${e}-<handler`)]:void 0}],s.edges=[this.drawEdgeNew(`${e}-body`,`${e}-handler`,s,void 0,"RIGHT")]):"Entry"===s.type||"Exit"===s.type?(s.width=18,s.height=18):"retain"===s.type?(s.width=4,s.height=4):"Dummy"===s.type?(s.label===s.id?(s.width=4,s.height=4):(s.width=.875*s.label.length*5,s.height=8.75),this.visited&&Array.isArray(n)&&n.forEach((e=>{const t=g(e);this.visited[t]&&this.visited[t].forEach((e=>{this.activations[e].response.success&&(void 0===this.visited[s.id]&&(this.visited[s.id]=[],s.visited=[]),this.visited[s.id].push(e),s.visited.push(e))}))}))):"let"===s.type||"literal"===s.type?(s.label.length>30?s.width=160:s.width=5*s.label.length+10,s.height=20,s.tooltip=s.label,delete s.label,s.width=20,s.height=20):"retry"===s.type?(s.children=[],s.edges=[],s.retryCount=t,s.label=`Retry ${t} time${parseInt(t,10)>1?"s":""}`):"repeat"===s.type&&(s.children=[],s.edges=[],s.repeatCount=t,s.label=`Repeat ${t} time${parseInt(t,10)>1?"s":""}`);return s}drawEdgeNew(e,t,i,n,r,s,o){for(let a=0;a<i.children.length&&(i.children[a].id===e&&(n?"true"!==n&&"false"!==n||(s=`${e}_p${n}`,i.children[a].properties.choice=!0):s=i.children[a].properties.choice?`${e}_pfalse`:`${e}_p${i.children[a].ports.length}`,i.children[a].ports.push({id:s,properties:{portSide:r||"SOUTH"}})),i.children[a].id===t&&(o=`${t}_p${i.children[a].ports.length}`,i.children[a].ports.push({id:o,properties:{portSide:r||"NORTH"}})),!s||!o);a++);return void 0!==s&&void 0!==o||u("source or target not found",e,t,i,this.graphData),{id:e+"_"+s+"->"+t+"_"+o,source:e,sourcePort:s,target:t,targetPort:o,visited:this.visited?!(!this.visited[e]||!this.visited[t]):void 0}}ir2graph(e,t,i,n,r={}){if("sequence"===e.type||"seq"===e.type||Array.isArray(e)){let s,a,d=0;return a="sequence"===(o=e).type||"seq"===o.type?e.components:e,a.forEach((e=>{e.options&&e.options.helper||(s=this.ir2graph(e,t,`${i}-${d}`,d>0?s:n,r),d++)})),s}if(function(e){return"action"===e.type}(e)){let s=e.name;return e.displayLabel&&(s+=`|${e.displayLabel}`),t.children.push(this.drawNodeNew(i,s,e.type,void 0,r)),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,i,t)))),[i]}if(function(e){return"function"===e.type}(e))return t.children.push(this.drawNodeNew(i,e.function.exec.prettyCode||e.function.exec.code,e.type,void 0,r)),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,i,t)))),[i];if(function(e){return"if"===e.type}(e)){const s=t.children.length,o=this.ir2graph(e.test,t,`${i}-test`,void 0,r),a=t.children.length,d=this.ir2graph(e.consequent,t,`${i}-consequent`,void 0,r);let h,l,c;"empty"!==e.alternate.type&&(h=t.children.length,l=this.ir2graph(e.alternate,t,`${i}-alternate`,void 0,r)),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,t.children[s].id,t)))),c=o.length>1?this.addDummy(o,void 0,t,r):o[0],t.edges.push(this.drawEdgeNew(c,t.children[a].id,t,"true")),l&&l.length>0?t.edges.push(this.drawEdgeNew(c,t.children[h].id,t,"false")):l=[c];return[this.addDummy(l.concat(d),void 0,t,r)]}if(function(e){return"try"===e.type}(e)){t.children.push(this.drawNodeNew(i,"Try-Catch","try_catch",void 0,r)),n?n.forEach((e=>t.edges.push(this.drawEdgeNew(e,i,t)))):t.children[t.children.length-1].properties.compoundNoParents=!0;const s=t.children[t.children.length-1],o=s.children[0],a=s.children[1];return this.ir2graph(e.body,o,o.id+"-components",void 0,r),this.ir2graph(e.handler,a,a.id+"-components",void 0,r),[t.children[t.children.length-1].id]}if(a(e)||d(e)){let s,o,h,l,c,p;return a(e)?(s=t.children.length,h=this.ir2graph(e.test,t,`${i}-test`,void 0,r),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,t.children[s].id,t)))),o=t.children.length,l=this.ir2graph(e.body,t,`${i}-body`,void 0,r)):d(e)&&(o=t.children.length,l=this.ir2graph(e.body,t,`${i}-body`,void 0,r),s=t.children.length,h=this.ir2graph(e.test,t,`${i}-test`,void 0,r)),c=h.length>1?this.addDummy(h,void 0,t,r):h[0],p=l.length>1?this.addDummy(l,void 0,t,r):l[0],t.edges.push(this.drawEdgeNew(c,t.children[o].id,t,"true")),t.edges.push(this.drawEdgeNew(p,t.children[s].id,t)),!n||"dowhile"!==e.type&&"dowhile_nosave"!==e.type||n.forEach((e=>t.edges.push(this.drawEdgeNew(e,t.children[o].id,t)))),[c]}if(function(e){return"retain"===e.type}(e)){t.children.push(this.drawNodeNew(`${i}__origin`,"",e.type,void 0,r)),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,`${i}__origin`,t))));const s=this.ir2graph(e.components,t,i,[`${i}__origin`],r);t.children.push(this.drawNodeNew(`${i}__terminus`,"",e.type,void 0,r)),s&&s.forEach((e=>t.edges.push(this.drawEdgeNew(e,`${i}__terminus`,t))));const o=this.drawEdgeNew(`${i}__origin`,`${i}__terminus`,t,void 0,"EAST");return o.properties={type:"retain"},t.edges.push(o),[`${i}__terminus`]}if(function(e){return"retry"===e.type||"repeat"===e.type}(e))return t.children.push(this.drawNodeNew(i,e.count,e.type,void 0,r)),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,i,t)))),this.ir2graph(e.components,t.children[t.children.length-1],`${i}-components`,void 0,r),[t.children[t.children.length-1].id];if(function(e){return"let"===e.type}(e)){const s=JSON.stringify(e.declarations,void 0,4);return t.children.push(this.drawNodeNew(i,s,e.type,void 0,Object.assign(r,{value:e.declarations}))),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,i,t)))),this.ir2graph(e.components,t,`${i}-components`,[i],r)}if(function(e){return"literal"===e.type||"value"===e.type}(e)){const s=JSON.stringify(e.value,void 0,4);return t.children.push(this.drawNodeNew(i,s,e.type,void 0,Object.assign(r,{value:e.value}))),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,i,t)))),[i]}if(function(e){return"finally"===e.type}(e)){const s=this.ir2graph(e.body,t,`${i}-body`,n,r);return this.ir2graph(e.finalizer,t,`${i}-finalizer`,s,r)}if(function(e){return"parallel"===e.type||"par"===e.type||"map"===e.type||"forall"===e.type}(e)){const s="map"===e.type||"forall"===e.type?"Parallel Map over Array":"Execute Tasks in Parallel",o="par"===e.type||"parallel"===e.type?"Parallel":"map"===e.type?"Map":e.type,a="map"===e.type||"forall"===e.type?"Executes a single task in parallel for each element of the input array":"Executes a set of tasks in parallel, passing the same input data to each task";let d=n;e.set&&(d=this.ir2graph(e.set,t,`${i}-${e.type}-set`,d,r));const h=this.addDummy(d,void 0,t,{label:s,tooltipHeader:o,tooltip:a});let l;if(d=[h],function(e){return"map"===e.type||"forall"===e.type}(e)){const n=e.components||e.body;l=[n,n,{type:"literal",value:"..."},n].map(((e,n)=>this.ir2graph(e,t,`${i}-component-${n}`,d,r)[0]))}else l=e.components.map(((e,n)=>this.ir2graph(e,t,`${i}-component-${n}`,d,r)[0]));return[this.addDummy(l,void 0,t,{label:"Wait for Completion",tooltipHeader:`${o} completion`,tooltip:"Wait for the parallel tasks to complete, and then return an array of results"})]}if(function(e){return"object"==typeof e.components}(e)){const o=(s=e.type).charAt(0).toUpperCase()+s.substring(1),a=e.type,d=this.drawNodeNew(i,o,a,void 0,r);return d.children=[],d.edges=[],t.children.push(d),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,i,t)))),this.ir2graph(e.components,d,`${i}-components`,void 0,r),[i]}if("object"==typeof e){const s="action",o=e.type;return t.children.push(this.drawNodeNew(i,o,s,void 0,r)),n&&n.forEach((e=>t.edges.push(this.drawEdgeNew(e,i,t)))),u("generic handler",e,o,s),[i]}var s,o}}const y=e=>{if(void 0===e)return 0;if("function"===e.type)return 0;if(e.type){let t=0;for(const i in e)t+=y(e[i]);return t+1}return Array.isArray(e)?e.reduce(((e,t)=>e+y(t)),0):0},v=e=>{const t=!function(e){const t=e;return Array.isArray(t.components)&&t.components.length>0}(e)||e.components.length<=2,i=y(e),n=i<=3;return u("isSimpleComposition",t,i),t&&n};function m(e,t,n,r,s,o){return p(this,void 0,void 0,(function*(){const a=new f(r);a.activations?(u("activations",a.activations),a.visited={},a.activations.forEach(((e,t)=>{e.logs&&e.logs.forEach((e=>{if(-1!==e.indexOf("Entering composition")){let i=e.substring(e.lastIndexOf(" ")+1);i=i.replace(/[\[\.]/g,"-").replace(/\]/g,""),void 0===a.visited[i]&&(a.visited[i]=[]),a.visited[i].push(t)}}))})),Object.keys(a.visited).forEach((e=>{const t=e.split("-");t.pop();const i=t.join("-");void 0===a.visited[i]&&(a.visited[i]=[]),a.visited[i]=a.visited[i].concat(a.visited[e])})),u("visited nodes:",a.visited)):a.actions={},u("generating graph model");const d=v(t),p=Object.assign({renderFunctionsInView:d},s);if(o&&o.trigger||h(t)){u("using rule as start",o);const e=a.drawNodeNew("Entry","trigger","Entry");e.properties.kind="trigger",e.properties.kindDetail=o?o.trigger.name:h(t)&&t.trigger,e.width=24,a.graphData.children.push(e),h(t)&&(t=t.components)}else a.graphData.children.push(a.drawNodeNew("Entry","start","Entry"));let g=a.ir2graph(t,a.graphData,"composition",["Entry"],p);void 0===g&&(g=["Entry"]),a.graphData.children.push(a.drawNodeNew("Exit","end","Exit",g)),g.forEach((e=>a.graphData.edges.push(a.drawEdgeNew(e,"Exit",a.graphData)))),u("graphData",a.graphData);const y=yield function(e,t,i,n,r){return l(this,void 0,void 0,(function*(){try{if(t){c("actions",t);const s=[],o=Object.keys(t);o.forEach((t=>{s.push(e.REPL.qexec(`wsk action get "${t}"`))}));const a=yield Promise.all(s.map((e=>e.catch((e=>e))))),d=[],h=(e,t,i)=>e.forEach((e=>{if(e.id===t)e.deployed=i;else if(e.children)return h(e.children,t,i)}));if(a.forEach(((e,i)=>{"Action"===e.kind&&e.metadata.name?(c(`action ${e.metadata.name} is deployed`),t[o[i]].forEach((e=>{h(n.children,e,!0)}))):(c(`action ${o[i]} is not deployed`,e,o),t[o[i]]&&(d.push(o[i]),t[o[i]].forEach((e=>{h(n.children,e,!1)}))))})),d.length>0&&!i&&(!r||!r.noHeader)){const e={message:"wskflow-undeployed-action-warning",text:"wskflow-undeployed-action-warning-text",examples:"wskflow-undeployed-action-warning-examples",examplesExtra:["deemphasize","deemphasize-partial","left-pad"]},t=document.createElement("div"),i=document.createElement("strong"),n=document.createElement("span"),r=document.createElement("span");t.className=e.message,n.className=e.text,i.className="red-text",r.className=e.examples,e.examplesExtra.forEach((e=>r.classList.add(e))),t.appendChild(i),t.appendChild(n),t.appendChild(r),i.innerText="Warning: ";const s=1===d.length?"component":"components";return n.innerText=`depends on ${d.length} undeployed ${s}`,t}}}catch(e){c("action get fetching error: ",e)}}))}(e,a.actions,a.activations,a.graphData,s);u("subtext",y),u("inserting DOM, calling graph2doms");const m=(yield i.e(460).then(i.bind(i,70460))).default,w=yield m(e,a.graphData,n,a.activations);return Object.assign(w,{subtext:y})}))}var w=function(e,t,i,n){return new(i||(i=Promise))((function(r,s){function o(e){try{d(n.next(e))}catch(e){s(e)}}function a(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}d((n=n.apply(e,t||[])).next())}))};const E=r()("plugins/wskflow/visualize"),b=(e,t,i,n,r,o,a,d)=>w(void 0,void 0,void 0,(function*(){if((0,s.isHeadless)())return;E("visualize",t,a,d);const n=JSON.parse(JSON.stringify(t));return E("passfsm",JSON.stringify(t)),E("ir",n),m(e,n,i,o,a,d)}))}}]);