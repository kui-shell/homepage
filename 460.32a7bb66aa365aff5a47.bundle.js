(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[460],{70460:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>c});var n=i(11227),r=i.n(n),s=i(53589),o=function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};const a=r()("plugins/wskflow/graph2doms"),l="#81C784",p="#EC7063",d="#33a02c";function c(t,e,n,r,{layoutOptions:c={},composites:u={label:{fontSize:"4px",offset:{x:0,y:-3}}}}={}){return o(this,void 0,void 0,(function*(){const[o,{default:f},{default:g}]=yield Promise.all([i.e(5078).then(i.t.bind(i,15078,23)),i.e(9755).then(i.t.bind(i,19755,23)),i.e(7295).then(i.t.bind(i,17295,23))]),h=e.properties&&e.properties.maxLabelLength||10,y=e.properties&&e.properties.fontSize||"7px",v=o.behavior.zoom().on("zoom",(function(){!_&&q||(_=!1,q=!0,A());b=!1,w.attr("transform",`matrix(${o.event.scale}, 0, 0, ${o.event.scale}, ${o.event.translate[0]}, ${o.event.translate[1]})`),f("#qtip").removeClass("visible")})),m=n||f('<div id="wskflowDiv"></div>'),x=f('<div id="wskflowContainer"></div>');let b=!1;f(m).append(x),f(x).addClass("grabbable");const k=o.select(f(x)[0]).append("svg").attr("id","wskflowSVG").attr("data-is-session-flow",!!r).call(v),w=k.append("g").on("dblclick.zoom",null),C=w.append("g").attr("id","wskflowMainG").attr("class","kui--screenshotable"),P=C.append("svg:defs");P.append("svg:pattern").attr("id","pattern-stripe").attr("width",1.2).attr("height",1.2).attr("patternUnits","userSpaceOnUse").attr("patternTransform","rotate(45)").append("svg:rect").attr("width",.6).attr("height",2).attr("transform","translate(0,0)").attr("fill","#aaa"),P.append("svg:mask").attr("id","mask-stripe").append("svg:rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","url(#pattern-stripe)"),P.append("svg:pattern").attr("id","pattern-stripe-heavy").attr("width",1.2).attr("height",1.2).attr("patternUnits","userSpaceOnUse").attr("patternTransform","rotate(45)").append("svg:rect").attr("width",1).attr("height",2).attr("transform","translate(0,0)").attr("fill","#aaa"),P.append("svg:mask").attr("id","mask-stripe-heavy").append("svg:rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","url(#pattern-stripe-heavy)");const E=t=>{const e=P.append("svg:marker").attr("id",t).attr("viewBox","0 -5 10 10").attr("markerUnits","userSpaceOnUse").attr("markerWidth",4.2).attr("markerHeight",7).attr("orient","auto");return e.append("svg:path").attr("d","M0,-5L10,0L0,5"),e};E("end"),E("forwardingEnd").attr("refX",10),E("edgeTraversedEnd").attr("markerWidth",5.25).attr("markerHeight",8.75).attr("refX",2.4),E("greenEnd"),E("trueEnd"),E("falseEnd"),P.append("svg:g").attr("id","retryIconNormal").attr("transform","scale(0.02) rotate(90)").append("svg:path").attr("d","M852.8,558.8c0,194.5-158.2,352.8-352.8,352.8c-194.5,0-352.8-158.3-352.8-352.8c0-190.8,152.4-346.7,341.8-352.5v117.4l176.4-156.9L489,10v118C256.3,133.8,68.8,324.8,68.8,558.8C68.8,796.6,262.2,990,500,990c237.8,0,431.2-193.4,431.2-431.2H852.8z"),f("#qtip")[0]||f(document.body).append("<div id='qtip'><span id='qtipArrow'>&#9668</span><div id='qtipContent'></div></div>"),r&&f(x).append("<div id='actList' style='position: absolute; display:none; background-color: rgba(0, 0, 0, 0.8); color: white; font-size: 0.75em; padding: 1ex; width:225px; right: 5px; top: 5px;'></div>");const $=C.append("g");let L,_=!0,q=!1;function O(t){k.attr("viewBox",`0 0 ${L.width} ${L.height}`),k.attr("preserveAspectRatio",`xMidYMin ${t}`),w.attr("transform",""),f("#wskflowSVG").removeAttr("transform"),v.translate([0,0]),v.scale(1)}const S=()=>O("meet"),T=()=>{O("slice"),_=!1};const D=(new g).layout(e,{layoutOptions:Object.assign({"elk.algorithm":"org.eclipse.elk.layered","org.eclipse.elk.direction":"DOWN","org.eclipse.elk.edgeRouting":"ORTHOGONAL","org.eclipse.elk.layered.nodePlacement.bk.fixedAlignment":"BALANCED","elk.layered.spacing.nodeNodeBetweenLayers":15,"org.eclipse.elk.insideSelfLoops.activate":!0},c)}).then((e=>{L=e,L.height>800?T():S();const i=function(t){const e=[t],i=[];let n;for(;null!=(n=e.pop());)i.push(n),(n.children||[]).forEach((function(t){if(t.x+=n.x,t.y+=n.y,t.edges)for(let e=0;e<t.edges.length;e++)if(t.edges[e].sections[0].startPoint.x+=t.x,t.edges[e].sections[0].startPoint.y+=t.y,t.edges[e].sections[0].endPoint.x+=t.x,t.edges[e].sections[0].endPoint.y+=t.y,t.edges[e].sections[0].bendPoints)for(let i=0;i<t.edges[e].sections[0].bendPoints.length;i++)t.edges[e].sections[0].bendPoints[i].x+=t.x,t.edges[e].sections[0].bendPoints[i].y+=t.y;e.push(t)}));return i}(e),n=function(t){return o.merge(t.map((function(t){return t.edges||[]})))}(i),c=[];n.forEach((t=>{const e={id:t.id,labels:t.labels,visited:t.visited,source:t.source,sourcePort:t.sourcePort,target:t.target,targetPort:t.targetPort,sourcePoint:{x:t.sections[0].startPoint.x,y:t.sections[0].startPoint.y},targetPoint:{x:t.sections[0].endPoint.x,y:t.sections[0].endPoint.y},properties:t.properties,bendPoints:[]};t.sections[0].bendPoints&&t.sections[0].bendPoints.forEach((t=>e.bendPoints.push(t))),c.push(e)})),function(e,i){a("drawGraph");const n=$.selectAll(".node").data(e,(function(t){return t.id})).enter().append("g").attr("transform",(function(t){return"translate("+(t.x||0)+" "+(t.y||0)+")"})).attr("class",(function(t){let e="node";return t.children?e+=" compound":e+=" leaf",(t.tooltipHeader||"function"===t.type||"action"===t.type)&&(e+=" wskflow-node-with-special-meaning"),t.properties&&t.properties.compoundNoParents&&(e+=" no-parents"),void 0!==t.type?e+=" "+t.type:e+=" "+t.label,"action"!==t.type&&"function"!==t.type||(e+=" Task"),(t.retryCount||t.repeatCount)&&(e+=" repeat"),e})).attr("id",(function(t){return t.id})).attr("data-task-index",(t=>t.taskIndex)).attr("data-name",(function(t){const e="Entry"===t.type||"Exit"===t.type?t.type:t.multiLineLabel?t.fullFunctionCode.replace(/\n/g,""):t.label;return e&&("/"!==e.charAt(0)?`/_/${e}`:e)})).attr("data-kind",(t=>t.properties&&t.properties.kind)).attr("data-kind-detail",(t=>t.properties&&t.properties.kindDetail)).attr("data-deployed",(function(t){if(r);else{if("action"===t.type)return t.deployed?"deployed":"not-deployed";if(!1===t.deployed)return"not-deployed"}})).attr("data-status",(t=>{if(r){if(t.visited){let e=!0;return t.visited.forEach((t=>{r[t]&&r[t].response.success&&(e=!1)})),e?(f(this).attr("failed",!0),"failed"):"success"}return"not-run"}}));n.append((t=>document.createElementNS("http://www.w3.org/2000/svg",t.properties&&"trigger"===t.properties.kind?"polygon":"rect"))).attr("class",(t=>"atom"+("action"===t.type||t.onclick?" clickable":"")+(t.onclick?" has-onclick":""))).attr("points",(t=>{if(t.properties&&"trigger"===t.properties.kind)return"0 0, 0 13.5, 12 18, 24 13.5, 24 0, 12 6.25, 0 0"})).attr("width",(function(t){return t.width})).attr("height",(function(t){return t.height})).attr("rx",(function(t){if("Entry"===t.type||"Exit"===t.type)return"50%"})).attr("ry",(function(t){if("Entry"===t.type||"Exit"===t.type)return"50%"})).style("fill",(function(t){if(t.children)return"transparent"})).style("cursor",(function(t){return r?t.visited&&"action"===t.type?"pointer":"normal":"action"===t.type?"pointer":"normal"})).on("mouseover",(function(t){let e="",n=!1;if(r){if(void 0===t.children&&t.visited&&"block"!==f("#actList").css("display"))if("action"===t.type){let i;t.visited.length>1&&(e+="<div style='padding-bottom:2px;'>"+r.length+" activations</div>"),t.visited.forEach((t=>{const n=r[t],s=new Date(n.start);let o="";void 0!==i&&i===s.getMonth()+1+"/"+s.getDate()||(i=s.getMonth()+1+"/"+s.getDate(),o+=i+" "),o+=s.toLocaleTimeString(void 0,{hour12:!1});let a,d=n.duration.toString(),c="ms";n.duration>1e3&&(d=(n.duration/1e3).toFixed(2),c="s"),a=n.response.success?l:p,e+="<span style='color:"+a+"'>"+o+"</span> ("+d+c+")<break></break>";let u=JSON.stringify(n.response.result);u.length>40&&(u=u.substring(0,40)+"... "),e+=u,e="<div style='padding-bottom:2px;'>"+e+"</div>"}))}else if("Exit"===t.type){const i=r[t.visited[0]],n=new Date(i.start);let s=n.getMonth()+1+"/"+n.getDate()+" ";s+=n.toLocaleTimeString(void 0,{hour12:!1});let o=i.response.result?JSON.stringify(i.response.result,void 0,4):"";o.length>200&&(o=o.substring(0,200)+"â€¦"),e+=`<div style='padding-bottom:2px'><span class='qtip-prefix'>${t.type}</span> <span style='color:${l}'>${s}</span></div>${o}`}}else{if(t.children){if("try"===t.type)e="<span class='qtip-prefix red-text'>Try Block</span>";else if("handler"===t.type)e="<span class='qtip-prefix red-text'>Handler Block</span>";else if("try_catch"===t.type){const i=t.label||t.tooltip||"";if(-1!==i.indexOf(":"))e="<span class='qtip-prefix'>Try-Catch</span> <span style='color: orange'>"+i.substring(i.indexOf(":")+1)+"</span>";else if(-1!==i.indexOf("Repeat")){const t=i.split(" ")[1];e="<span class='qtip-prefix'>Repeat </span><span style='color: orange'>"+t+" times</span> then continue"}else e=`<span class='qtip-prefix'>${i}</span>`}}else if("action"===t.type&&"not-deployed"===f("#"+t.id).attr("data-deployed"))e="<span class='qtip-prefix red-text'>Warning |</span> This action is not deployed";else if("action"===t.type||"function"===t.type){const i="function"===t.type?"Inline Function":"Action";"function"===t.type&&(n=!0),e=t.multiLineLabel?`<span class='qtip-prefix ${t.type}'>${i}</span>`:`<span class='qtip-prefix ${t.type}' style="padding-right:5px; ">${i} |</span> ${t.label||t.tooltip||t.prettyCode}`}else if("retain"===t.type){let n;const r=t.id.indexOf("__origin")>-1,s=r?t.id:t.id.replace(/__terminus/,"__origin"),o=r?t.id.replace(/__origin/,"__terminus"):t.id;for(let t=0;t<i.length;t++)if(i[t].source===s&&i[t].target===o){n=i[t].id;break}n&&(e=r?`<span class='qtip-prefix ${t.type}' style='padding-right:5px; color: #85C1E9'>Retain |</span> Data forwarding</span>`:`<span class='qtip-prefix ${t.type}' style='padding-right:5px; color: #85C1E9'>Retain |</span> Data merging</span>`,f(".link[id='"+n+"']").addClass("hover forwarding-edge"))}else"Entry"===t.type?e=t.properties&&"trigger"===t.properties.kind?`<span class='qtip-prefix ${t.type}' style='padding-right:5px; color: #85C1E9'>Trigger |</span> ${t.properties.kindDetail}`:t.properties.title||"The composition starts here":"Exit"===t.type?e=t.properties.title||"The composition ends here":"let"!==t.type&&"literal"!==t.type||(e=`<div class='qtip-prefix let' style="margin-bottom:1ex; padding-right:5px; ">${t.type}</div>${t.label||t.tooltip}`,n=!0);t.properties&&t.properties.choice&&(e+="<div class='top-pad'>This is the <span style='color: orange;'>Y</span>/<span style='color: #DC7633;'>N</span> condition of an if</div>",f(".link[source='"+t.id+"_ptrue']").addClass("hover"),f(".link[source='"+t.id+"_pfalse']").addClass("hover"))}if(!e&&t.tooltip&&(e=`<div class='qtip-prefix ${t.tooltipColor?"color-base"+t.tooltipColor:"function"}' style="margin-bottom:1ex; padding-right:5px; ">${t.tooltipHeader||t.type}</div>${t.tooltip}`),e&&0!==e.length){f("#qtipContent").html(e),f("#qtip").addClass("visible"),n?f("#qtip").addClass("qtip-pre"):f("#qtip").removeClass("qtip-pre");const t=f(this)[0].getBoundingClientRect();let i=t.left+t.width,r=t.top+t.height/2-f("#qtip").height()/2;if(f("#wskflowContainer").hasClass("picture-in-picture")){const t=f("#wskflowContainer").css("transform");let e;try{e=parseFloat(t.substring("matrix(".length,t.indexOf(",")))}catch(i){console.log(i),console.log(t),e=.25}i/=e,r=f(this).offset().top+f(this)[0].getBoundingClientRect().height/2-f("#qtip").height()/2*e-f("#wskflowContainer").offset().top,r/=e}f("#qtip").css({left:i,top:r})}})).on("mouseout",(function(){f(".link").removeClass("hover"),f("#qtip").removeClass("visible")})).on("mousedown",(()=>{b=!0})).on("click",(function(e){if(b)if(b=!1,f("#qtip").removeClass("visible"),e.onclick)t.REPL.click(e.onclick,o.event);else if(r){if(e.visited)if("block"!==f("#actList").css("display")&&f("#listClose").click(),"Exit"===e.type);else if("action"===e.type)if(f("#qtip").removeClass("visible"),1===e.visited.length);else{let t,i="<div style='padding-bottom:5px'>Click on an activation here to view details</div>";i+=`<div>${e.label}<break</break>${e.visited.length} activations, ordered by start time: </div>`,i+="<ol style='padding-left: 15px;'>",e.visited.forEach((e=>{const n=r[e],s=new Date(n.start);let o="",a="";void 0!==t&&t===s.getMonth()+1+"/"+s.getDate()||(t=s.getMonth()+1+"/"+s.getDate(),o+=t+" "),o+=s.toLocaleTimeString(void 0,{hour12:!1});let d,c=n.duration.toString(),u="ms";n.duration>1e3&&(c=(n.duration/1e3).toFixed(2),u="s"),d=n.response.success?l:p,a+=`<span class='actItem' style='color:${d}; text-decoration:underline; cursor: pointer;' index=${e}>${o}</span> (${c+u})<break></break>`;let f=n.response?JSON.stringify(n.response.result):"";f.length>40&&(f=f.substring(0,40)+"... "),a+=f,i+="<li>"+a+"</li>"})),i+="</ol>",i="<div id='listClose' style='font-size:14px; color:lightgrey; display:inline-block; float:right; cursor:pointer; padding-right:5px;'>âœ–</div>"+i,f("#actList").html(i).css("display","block"),f(".actItem").hover((function(){f(this).css("text-decoration","none")}),(function(){f(this).css("text-decoration","underline")})).click((function(){})),f("#listClose").click((function(){f("#actList").css("display","none"),f("#"+e.id).children("rect").css("fill",l),f(this).css("fill",d)})),f("#qtip").removeClass("visible")}}else"action"===e.type&&"deployed"===f("#"+e.id).attr("data-deployed")&&(e.name?t.REPL.click(`wsk action get "${e.name}"`,o.event):a(`clicking on an inline function: ${e.label}`))}));const c=n.append("text").attr("width",(t=>t.width)).attr("x",(function(t){return t.children?u.label.offset.x:t.multiLineLabel?t.x:t.width/2})).attr("y",(function(t){return t.properties&&"trigger"===t.properties.kind?.675*t.height:t.children?u.label.offset.y:t.multiLineLabel?(t.height-6*t.multiLineLabel.length)/2:t.height/2+("Entry"===t.type||"Exit"===t.type||"Dummy"===t.type?1.5:"let"===t.type?3.5:2)})).attr("font-size",(function(t){return t.children?u.label.fontSize:t.properties&&t.properties.fontSize?t.properties.fontSize:"Entry"===t.type||"Exit"===t.type?"6px":y})).style("text-anchor",(function(t){if(!t.children&&!t.multiLineLabel)return"middle"})).style("pointer-events","none").attr("multi-line-label",(t=>t.multiLineLabel&&t.multiLineLabel.join("\n"))).text((function(t){if("retain"===t.type||"Dummy"===t.type&&t.label===t.id)return"";if("root"===t.id)return"";if("try"===t.type)return"Try";if("handler"===t.type)return"Catch";if(t.children)return t.label;if("let"===t.type||"literal"===t.type){const e="_",i=5,n=t.value.length>i?["â€¦",e]:[];return"string"==typeof t.value?t.value.substring(0,10)+(t.value.length>i?"â€¦":""):Array.isArray(t.value)?`[${t.value.slice(0,i-1).map((()=>e)).concat(n)}]`:`{${Object.keys(t.value).slice(0,i).concat(n)}}`}if("action"===t.type||"function"===t.type)return t.label;{let e=t.label;return void 0===e&&(e=t.id),e.length>h&&"Dummy"!==t.type?e.substring(0,h-1)+"...":e}}));for(let t=0;t<c[0].length;t++){const e=c[0][t],i=e.attributes&&e.attributes.getNamedItem("multi-line-label"),n=e.attributes&&e.attributes.getNamedItem("width");if(i){const{maxLineLength:t}=(0,s.KX)(i.value),r=2,a=(n.value-3*t)/2;i.value.split(/\n/).forEach((t=>{const i=/^\s+/,n=t.match(i),s=n?n[0].length:0;o.select(e).append("tspan").text(t.replace(i,"")).attr("x",a+s*r).attr("dy","1.25em")}))}}$.selectAll(".link").data(i,(function(t){return t.id})).enter().append("path").attr("id",(function(t){return t.id})).attr("d","M0 0").attr("marker-end",(function(t){return t.visited?"url(#greenEnd)":t.source.indexOf("__origin")>=0&&t.target.indexOf("__terminus")>=0?"url(#forwardingEnd)":"url(#end)"})).attr("class",(function(t){let e="link";if(0===t.source.indexOf("try_")&&0===t.target.indexOf("handler_")&&(e+=" TryCatchEdge"),t.source.indexOf("__origin")>=0&&t.target.indexOf("__terminus")>=0&&(e+=" forwardingLink has-hover-effect"),t.sourcePort&&-1!==t.sourcePort.indexOf("_ptrue")&&(e+=" true-branch"),t.sourcePort&&-1!==t.sourcePort.indexOf("_pfalse")&&(e+=" false-branch"),t.properties)for(const i in t.properties)e+=` ${i}`;return e})).attr("data-visited",(t=>t.visited)).attr("source",(function(t){return t.sourcePort})).on("mouseout",(function(){f("#qtip").removeClass("visible")})).on("mouseover",(function(t){if(t.properties&&"retain"===t.properties.type){const e=`<span class='qtip-prefix ${t.properties.type}' style='padding-right:5px; color: #85C1E9'>Retain |</span> Data forwarding edge</span>`;f("#qtipContent").html(e),f("#qtip").addClass("visible");const i=f(this)[0].getBoundingClientRect(),n=i.left+i.width,r=i.top+i.height/2-f("#qtip").height()/2;f("#qtip").css({left:n,top:r})}})).attr("d",(function(t){let e="";if(t.sourcePoint&&t.targetPoint){e+="M"+t.sourcePoint.x+" "+t.sourcePoint.y+" ",(t.bendPoints||[]).forEach((function(t){e+="L"+t.x+" "+t.y+" "}));const i=t.target.endsWith("-handler"),n=t.source.indexOf("__origin")>=0&&t.target.indexOf("__terminus")>=0||i?0:4.2,r=i?-4.2:0;e+="L"+(t.targetPoint.x+r)+" "+(t.targetPoint.y-n)+" "}return e})),setTimeout((()=>{o.select(".repeat").append("use").attr("xlink:href","#retryIconNormal").attr("href","#retryIconNormal").attr("x",10).attr("y",-14)}),0),setTimeout((()=>$.selectAll("path").attr("data-from-name",(function(t){const e=t.source,i=f("#"+e).attr("data-name");if(i)return i})).attr("data-to-name",(function(t){const e=t.target,i=f("#"+e).attr("data-name");if(i)return i}))),100),setTimeout((()=>i.forEach((t=>{if(t.labels&&t.labels.forEach((({text:e})=>{o.select("#"+t.source).append("text").classed("edge-label",!0).attr("x",10).attr("y",0).text(e)})),t.sourcePort&&(-1!==t.sourcePort.indexOf("_ptrue")||-1!==t.sourcePort.indexOf("_pfalse"))){let i,n,r,s,a,l;if(-1!==t.sourcePort.indexOf("_ptrue")?(i="Y",l="true-branch"):-1!==t.sourcePort.indexOf("_pfalse")&&(i="N",l="false-branch"),void 0!==i)for(let i=0;i<e.length;i++)if(e[i].id===t.source){let o,l;for(let a=0;a<e[i].ports.length;a++)e[i].ports[a].id===t.sourcePort&&(n=e[i].ports[a].properties.portSide,r=e[i].ports[a].x,s=e[i].ports[a].y),-1!==e[i].ports[a].id.indexOf("_ptrue")&&(o=e[i].ports[a].x),-1!==e[i].ports[a].id.indexOf("_pfalse")&&(l=e[i].ports[a].x);o&&l&&o>l&&(a=!0);break}if(void 0!==i&&void 0!==n){"WEST"===n?(r-=7,s-=3):"EAST"===n?(r+=7,s-=3):"NORTH"===n?(s-=7,a?"N"===i?r-=7:r+=3:"Y"===i?r-=7:r+=3):"SOUTH"===n&&(s+=7,a?"N"===i?r-=7:r+=3:"Y"===i?r-=7:r+=3);const e=f(`#${t.target}`),p="not-run"!==(e&&(e.attr("data-status")||"not-run"));o.select("#"+t.source).append("text").classed("edge-label",!0).attr("x",r).attr("y",s).text(i).classed("edge-was-traversed",p).classed(l,!0)}}}))),100)}(i,c)})).catch((t=>{console.error("[wskflow] error: ",t)})),N=[],A=()=>N.forEach((t=>t({applyAutoScale:_,customZoom:q}))),z=t=>{_=void 0!==t?t:!_,q=!1,A(),_?S():T()};return f(window).unbind("resize").resize((()=>{if(q&&void 0!==f("#wskflowSVG").attr("viewBox")){f("#wskflowSVG").removeAttr("viewBox");const t=f("#wskflowSVG").width(),e=f("#wskflowSVG").height(),i=Math.min(t/L.width,e/L.height),n=i*v.scale(),r=t/2-L.width*i/2+v.translate()[0]*i,s=e/2-L.height*i/2+v.translate()[1]*i;v.translate([r,s]),v.scale(n),w.attr("transform",`matrix(${n}, 0, 0, ${n}, ${r}, ${s})`)}})),D.then((()=>({view:f(m)[0],controller:{register:t=>N.push(t),zoomToFit:()=>z(!0),zoom1to1:()=>z(!1),is1to1:()=>!_}})))}))}}}]);