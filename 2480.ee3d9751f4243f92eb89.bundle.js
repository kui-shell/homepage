(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[2480,1077],{86375:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>d});var a=s(67294),i=s(51173),o=s(40688),n=s(1648),h=s(93284);const r=(0,i.i18n)("plugin-client-common");class d extends h.default{constructor(t){super(t),this.state=Object.assign(this.state,{isWatching:!0,lastUpdatedMillis:Date.now()})}componentDidMount(){this.initWatch()}isWatching(){return this.state.isWatching}dataAttrs(){return{"data-table-watching":this.isWatching(),"data-table-as-grid":this.state.asGrid}}render(){return this.props.onRender&&setTimeout((()=>this.props.onRender(!0))),super.render()}initWatch(){this.props.tab.state.captureJob(this.props.response.watch);const t=this.update.bind(this),e=this.batchUpdateDone.bind(this),s=this.offline.bind(this),a=this.done.bind(this),i=this.allOffline.bind(this),o=this.header.bind(this),n=this.footer.bind(this);this.props.response.watch.init({update:t,batchUpdateDone:e,offline:s,done:a,allOffline:i,header:o,footer:n})}pauseWatch(){this.props.response.watch.xoff&&(this.props.response.watch.xoff(),this.setState({isWatching:!1}))}resumeWatch(){this.props.response.watch.xon&&(this.props.response.watch.xon(),this.setState({isWatching:!0}))}watchControll(){this.state.isWatching?this.pauseWatch():this.resumeWatch()}caption(){if(this.state.lastUpdatedMillis){const t=this.state.isWatching?"Eye":"EyeSlash",e=this.state.isWatching?"green-text":"sub-text",s=this.state.isWatching?r("Pause watcher"):r("Resume watcher");return a.createElement(a.Fragment,null,(0,i.isSuspendable)(this.props.response.watch)?a.createElement("a",{href:"#",className:"kui--toolbar-button-watch","data-online":this.state.isWatching,onClick:this.watchControll.bind(this),onMouseDown:t=>t.preventDefault(),title:s,"aria-label":s},a.createElement(o.default,{icon:t,className:"small-right-pad "+e})):a.createElement(o.default,{icon:t,className:"small-right-pad "+e}),r("Last updated",new Date(this.state.lastUpdatedMillis).toLocaleTimeString()))}}offline(t){const e=this.state.body,s=e.findIndex((e=>e.rowKey?e.rowKey===t:e.name===t));if(-1===s)console.error("table row went offline, but not found in view model",t,e);else{const t=this.props.response.body[s];t.attributes.forEach((t=>{/STATUS/i.test(t.key)&&(t.value="Offline",t.css="red-background")}));const a=t,i=e.slice(0,s).concat([a]).concat(e.slice(s+1));this.setState({lastUpdatedMillis:Date.now(),body:i})}}allOffline(){this.props.response.body=[],this.setState({isWatching:!1,body:[],lastUpdatedMillis:Date.now()})}update(t,e=!1){if(!this.props.response.header){const e=(0,n.Z)([t]);e&&this.header(e)}const s=this._deferredUpdate||this.state.body,a=s.findIndex((e=>e.rowKey&&t.rowKey?e.rowKey===t.rowKey:e.name===t.name)),i=t,o=-1===a?s.concat([i]):s.slice(0,a).concat([i]).concat(s.slice(a+1));-1===a?this.props.response.body.push(t):this.props.response.body[a]=t,e?this._deferredUpdate=o:this.setState({body:o,lastUpdatedMillis:Date.now()})}batchUpdateDone(){if(this._deferredUpdate){const t=this._deferredUpdate;this._deferredUpdate=void 0,this.setState({body:t,lastUpdatedMillis:Date.now()})}}header(t){this.props.response.header=t,this.setState({header:t,lastUpdatedMillis:Date.now()})}footer(t){this.props.response.footer=this.props.response.footer?this.props.response.footer.concat(t):t,this.setState((e=>({lastUpdatedMillis:Date.now(),footer:e.footer?e.footer.concat(t):t})))}done(){this.setState({isWatching:!1,lastUpdatedMillis:Date.now()})}}}}]);