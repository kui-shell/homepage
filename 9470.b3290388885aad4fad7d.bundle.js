(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[9470,2383,5438],{5438:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f,doExec:()=>p});var o=n(11227),r=n.n(o),s=n(32383),i=n(51173);const c=r()("plugins/bash-like/util/json");var a=n(68993),l=n(7716),d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}a((o=o.apply(e,t||[])).next())}))};const u=r()("plugins/bash-like/cmds/general"),p=(e,t)=>new Promise(((n,o)=>d(void 0,void 0,void 0,(function*(){const r={maxBuffer:1048576,env:Object.assign({},l.env,t.env||{})};l.env.SHELL&&(r.shell=l.env.SHELL);const i=(0,s.exec)(e,r);let a="",p="";i.stdout.on("data",(e=>d(void 0,void 0,void 0,(function*(){const n=e.toString();t.stdout?t.stdout(e):a+=n})))),i.stderr.on("data",(e=>{p+=e,t.stderr&&t.stderr(e.toString())})),i.on("close",(e=>d(void 0,void 0,void 0,(function*(){if(0===e)if(t&&t.json)try{n(JSON.parse(a))}catch(e){const t=new Error("unexpected non-JSON");t.value=a,o(t)}else if(t&&t.raw)n(a);else if(a||p){const e=(e=>{const t=e.substring(e.indexOf("{"));if(t.length>0)try{const e=JSON.parse(t);return c("successfully parsed out json",e),e}catch(e){}})(a);e&&"object"==typeof e?(e.type="shell",e.verb="get",n(e)):n(a)}else n(!0);else{u("non-zero exit code",e);const n=p.replace(/(^\/[^/]+\/[^:]+: )(line \d+: )?/,"");try{((e,t,n,o,r,s)=>{const i=0===o.length?n:o;if(r&&r.nested&&127!==t){const e=new Error(i);throw e.code=t,e}{const e=new Error(i);throw e.html=s,r.stderr?e.code=s:i.match(/File exists/i)?e.code=409:127!==t&&i.match(/not found/i)?e.code=404:e.code=t,e}})(0,e,a,n,t)}catch(e){o(e)}}}))))})))),h=e=>{if(e.execOptions.type===i.ExecType.TopLevel)throw new Error("this command is intended for internal consumption only");return(0,a.XN)(e)},f=e=>{e.listen("/!",a.XN,{docs:"Execute a UNIX shell command",requiresLocal:!0}),e.listen("/sendtopty",h,{docs:"Execute a UNIX shell command with a PTY",hidden:!0}),e.listen("/pwd",(()=>l.env.PWD||"/"))}},68993:(e,t,n)=>{"use strict";n.d(t,{XN:()=>a,Io:()=>l,MA:()=>d});var o=n(11227),r=n.n(o),s=n(51173),i=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{a(o.next(e))}catch(e){s(e)}}function c(e){try{a(o.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}a((o=o.apply(e,t||[])).next())}))};const c=r()("plugins/bash-like/cmds/catchall"),a=({tab:e,command:t,argvNoOptions:o,execOptions:r,parsedOptions:c,createOutputStream:a})=>i(void 0,void 0,void 0,(function*(){const i=e=>{throw e.message&&"string"==typeof e.message?new Error(e.message.replace(/[a-zA-Z0-9/]+:\s*/,"").trim()):e},l=(r.raw||r.type===s.ExecType.Nested)&&void 0===r.quiet&&void 0===r.echo&&void 0===r.replSilence,d=l||r.isProxied?r:Object.assign({},{stdout:yield a()},r),u=t.replace(/^(!|sendtopty)\s+/,"");if((0,s.isHeadless)()||!(0,s.inBrowser)()&&l){const{doExec:e}=yield n.e(5438).then(n.bind(n,5438)),t=yield e(u,d).catch(i);if(l&&("number"==typeof t||"boolean"==typeof t))return t;if(l&&"string"==typeof t)try{return isNaN(parseInt(t))?JSON.parse(t):t}catch(e){}return t}{const{doExec:t}=yield Promise.all([n.e(8575),n.e(9267),n.e(2320),n.e(5301),n.e(1051)]).then(n.bind(n,51153)),r=()=>t(e,u,o,c,d);if(l){d.quiet=!0,d.echo=!1,d.replSilence=!0;let e="";return d.onInit=()=>t=>{"string"==typeof t&&(e+=t)},r().then((()=>e)).catch(i)}return r().catch(i)}}));function l(e){return i(this,void 0,void 0,(function*(){return new Promise(((t,n)=>i(this,void 0,void 0,(function*(){let o="";const r=Object.assign({},e.execOptions,{rethrowErrors:!0,quiet:!0,replSilence:!0,echo:!1,onInit:()=>e=>{"string"==typeof e&&(o+=e)}}),s=Object.assign({},e,{execOptions:r});yield a(s).catch((e=>{console.error(e),e.message=o||e.message,n(e)})),t(o)}))))}))}const d=e=>{if(!(0,s.inBrowser)()||(0,s.hasProxy)())return e.catchall((()=>!0),a,0);c("skipping catchall registration: in browser and no remote proxy to support it")}},29470:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var o=n(5438),r=n(82208),s=n(51173);const i=({tab:e,parsedOptions:t})=>{const n=s.SymbolTable.read(e),o=t._[1].split("="),r=o[0],i=o[1];return n[r]=i,s.SymbolTable.write(e,n),s.eventBus.emitEnvUpdate(r,i),!0},c={command:"export",strict:"export",docs:"Export a variable or function to the environment of all the child processes running in the current shell",required:[{name:"key=value",docs:"an assignment of key to value"}]},a=e=>{return Promise.all([(0,o.default)(e),(0,r.default)(e),(t=e,void t.listen("/export",i,{usage:c}))]);var t}},32383:()=>{}}]);