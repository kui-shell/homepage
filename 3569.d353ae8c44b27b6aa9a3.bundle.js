(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[3569],{22631:(t,e,n)=>{"use strict";n.d(e,{Q:()=>c,Z:()=>l});var o=n(63744),i=n(81634),r=n(26472),a=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};function c(t,e){return a(this,void 0,void 0,(function*(){const n=(yield t.REPL.qexec(`kubectl get all -n ${e} -o custom-columns=KIND:.kind`)).body.reduce(((t,{name:e})=>(t[e]=(t[e]||0)+1,t)),{});return{header:{name:"KIND",attributes:[{key:"COUNT",value:"COUNT"}]},body:Object.keys(n).map((t=>({name:t,onclick:`kubectl get ${t} -n ${e}`,attributes:[{key:"COUNT",value:n[t].toLocaleString()}]}))).sort(((t,e)=>n[e.name]-n[t.name]))}}))}function s(t){const e=t.argvNoOptions[t.argvNoOptions.length-1];return c(t.tab,e)}function u({tab:t}){return a(this,void 0,void 0,(function*(){return(yield(0,o.AF)(t)).metadata.namespace}))}const l=t=>{t.listen(`/${i.Z}/namespace/current`,u,r.L6),t.listen(`/${i.Z}/namespace/summarize`,s,r.L6)}},89492:(t,e,n)=>{"use strict";function o(t){return"IP"===t?t:t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function i(t){return t.body.reduce(((t,e)=>(t[o(e.key)]=e.name,e.attributes.forEach((({key:e,value:n})=>{t[o(e)]=n})),t)),{})}n.d(e,{k:()=>o,Z:()=>i})},43569:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>it});var o=n(51173),i=n(40227),r=n(21045),a=n(81634),c=n(67808),s=n(8749),u=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const l=t=>e=>u(void 0,void 0,void 0,(function*(){if((0,s.lN)(e))return(0,s.t$)(t,e);{const n=yield(0,r.GL)(e,void 0,t),{content:{stderr:i,stdout:a}}=n;if((0,o.isXtermResponse)(a))return a;const s=yield(0,c.rW)(a,i,e,t,"explain","api-resources");return(0,o.isTable)(s)&&(s.body.forEach((e=>{const n=e.attributes[3]&&e.attributes[3].value||e.name;e.onclick=`${t} explain ${n}`})),s.body.sort(((t,e)=>t.name.localeCompare(e.name)))),s}}));var d=n(63744),f=n(28882),p=n(89492);function m(t,e){return(0,o.flatten)([t,`${t}s`].concat(e?[e]:[]).map((t=>[t,(0,p.k)(t)])))}var v=n(26472),h=n(54476),y=n(79895),b=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};function k(t){return b(this,void 0,void 0,(function*(){const e=yield(0,v.gc)((0,y.fY)(t))(t);if((0,o.isTable)(e)&&e.header){(0,c.ei)("up-to-date",e);const t=e.header.attributes.findIndex((t=>/Ready/i.test(t.key)));t>=0&&((0,c.ov)(t,e),e.statusColumnIdx=t,e.body.forEach((e=>{const n=e.attributes[t];if(n&&n.value){const t=n.value.match(/(\d+)\/(\d+)/);if(t&&3===t.length){n.tag="badge";const e=parseInt(t[1],10),o=parseInt(t[2],10);n.css=e===o?h.Z.Green:0===e?h.Z.Red:h.Z.Yellow}}})))}return e}))}const $=t=>{var e,n,i,r;(e="deployment",n="deploy",i="v1",r="apps",i?(0,o.flatten)(m(e,n).map((t=>[t,`${t}.${r}`,`${t}.${i}.${r}`]))):m(e,n)).forEach((e=>{["k","kubectl","oc"].forEach((n=>{t.listen(`/${a.Z}/${n}/get/${e}`,k,v.L6)}))}))};var x=n(14945),w=n(26470),g=n(53156),Z=n(21274),O=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const P=(0,o.i18n)("plugin-kubectl"),N=t=>function(e){return O(this,void 0,void 0,(function*(){if((0,s.lN)(e))return(0,s.t$)(t,e);try{const{REPL:n}=e,i=(0,g.$L)(e),r=(0,o.findFile)((0,o.expandHomeDir)(i)),a=(0,w.basename)(i),c=(0,w.dirname)(i),s="."===c?void 0:c;console.error("!!1",`${t} get ${(0,g.W2)(e)} -o yaml`),console.error("!!2",`${t} apply ${(0,g.W2)(e)} --dry-run=server -o yaml`);const[u,l]=yield Promise.all([n.qexec((0,g.QG)(e,`${t} get ${(0,g.W2)(e)} -o yaml`)),n.qexec((0,g.QG)(e,`${t} apply ${(0,g.W2)(e)} --dry-run=server -o yaml`))]);if(console.error("previous",u),console.error("current",l),(0,Z.Ib)(u)&&(0,Z.Ib)(l)){const t={mode:"diff",label:P("Pending Changes"),content:{a:(0,y.p2)(u.kuiRawData),b:(0,y.p2)(l.kuiRawData)},contentType:"yaml"};return{apiVersion:"kui-shell/v1",kind:"File",metadata:{name:a,namespace:s},toolbarText:{type:"info",text:P("Showing changes between the working tree and previous commit.")},modes:[t],spec:{filepath:i,fullpath:r}}}throw new Error("failed to get resources")}catch(n){return console.error("error at kubectl diff",n),(0,r.GL)(e,void 0,t)}}))};function E(t,e,n=e){t.listen(`/${a.Z}/${e}/diff`,N(n))}var L=n(28040),T=n(65187),R=n(80625),I=n(22631),z=n(21858),C=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const G=(0,o.i18n)("plugin-kubectl","kustomize");function A(t){const e=t.argvNoOptions.indexOf("kustomize"),n=t.argvNoOptions[e+1];return n?t.command.replace(new RegExp(n,"g"),(0,o.expandHomeDir)(n)):t.command}function j(t,e){const n=e.split(/---/),o=t.reduce(((t,e,o)=>{const i=(0,z.H1)(e);return t[i]||(t[i]={label:i,items:[]}),t[i].items.push({mode:e.metadata.name,content:n[o].replace(/^\n/,""),contentType:"yaml"}),t}),{}),i={label:G("Raw Data"),items:[{mode:"YAML",content:e,contentType:"yaml"}]};return Object.values(o).concat([i])}const D=(t="kubectl")=>e=>C(void 0,void 0,void 0,(function*(){if((0,s.lN)(e))return(0,s.t$)(t,e);{const[o,{safeLoadAll:i}]=yield Promise.all([(0,r.d1)(e,A,t),n.e(3320).then(n.t.bind(n,93320,23))]);try{const t=i(o),n=(0,w.resolve)(e.argvNoOptions[e.argvNoOptions.indexOf("kustomize")+1]);return{apiVersion:"kui-shell/v1",kind:"NavResponse",breadcrumbs:[{label:"kustomize"},{label:(0,w.basename)(n),command:`open ${n}`}],menus:j(t,o)}}catch(t){return console.error("error preparing kustomize response",t),o}}}));var S=n(65458),q=n(14867),B=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const _="top",F=t=>function(e){return B(this,void 0,void 0,(function*(){if((0,s.lN)(e))return(0,s.t$)(t,e);{const n=yield(0,r.GL)(e);return(0,v.Bm)(t,e,n,_)}}))};var Q=n(35501),U=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};function W(t){["kubectl","k"].forEach((e=>{const n=(0,v.gc)(e);var i,r,c;(i="job",r="v1",c="batch",(0,o.flatten)((0,o.flatten)([i,`${i}s`].map((t=>[t,(0,p.k)(t)]))).map((t=>[t,`${t}.${c}`,`${t}.${r}.${c}`])))).forEach((i=>{t.listen(`/${a.Z}/${e}/get/${i}`,(t=>U(this,void 0,void 0,(function*(){if((0,g.QI)(t))return n(t);const e=t.argvNoOptions.slice(t.argvNoOptions.indexOf(i)+1),r=0===e.length?"job-name":`'job-name in (${e.join(",")})'`,a=(0,g.QG)(t,`kubectl get pod -l ${r} --sort-by={.status.startTime} -o custom-columns=JOB:.metadata.ownerReferences[0].name,NAME:.metadata.name,STATUS:.status.phase,START:.status.startTime,START2:.status.containerStatuses[0].state.terminated.startedAt,END:.status.containerStatuses[0].state.terminated.finishedAt ${(0,g.nf)(t)} ${t.parsedOptions.limit?`--limit ${t.parsedOptions.limit}`:"--limit 200"}`),c=yield t.REPL.qexec(a,void 0,void 0,t.execOptions);return(0,o.isTable)(c)?(c.title="Job",c):c}))),v.L6)}))}))}var H=n(70690),K=n(11227),Y=n.n(K),J=n(65402),M=n(48764).Buffer,V=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const X=Y()("plugin-kubectl/controller/fetch-file");function tt(t){return V(this,void 0,void 0,(function*(){const{lstat:e}=yield Promise.resolve().then(n.t.bind(n,12993,23));return new Promise(((n,o)=>{e(t,((t,e)=>{t?"ENOENT"===t.code?n(!1):o(t):n(e.isFile())}))}))}))}function et(t,e){return V(this,void 0,void 0,(function*(){const[o,{join:i}]=yield Promise.all([tt(e),Promise.resolve().then(n.t.bind(n,26470,23))]);if(o)return{data:yield(0,J.LG)(t,e)[0]};{const n=i(e,"kustomization.yml"),o=i(e,"kustomization.yaml"),r=i(e,"Kustomization"),[a,c,s]=yield Promise.all([tt(n),tt(o),tt(r)]),u=e;if(a)return{data:(yield(0,J.LG)(t,n))[0]||"",dir:u};if(c)return{data:(yield(0,J.LG)(t,o))[0]||"",dir:u};if(s)return{data:(yield(0,J.LG)(t,r))[0]||"",dir:u}}}))}const nt=t=>/^k(ubectl)?$/.test(t);var ot=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{s(o.next(t))}catch(t){r(t)}}function c(t){try{s(o.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))};const it=t=>ot(void 0,void 0,void 0,(function*(){var e;(t=>{t.listen(`/${a.Z}/kubectl/api-resources`,l("kubectl"),i.Z),t.listen(`/${a.Z}/k/api-resources`,l("kubectl"),i.Z)})(t),(0,d.ZP)(t),(0,f.ZP)(t),(0,x.Z)(t),(t=>{E(t,"kubectl"),E(t,"k","kubectl")})(t),(0,T.ZP)(t),(0,L.ZP)(t),(0,R.Z)(t),W(t),(0,v.ZP)(t),(0,I.Z)(t),$(t),(t=>{t.listen(`/${a.Z}/kubectl/kustomize`,D(),i.Z),t.listen(`/${a.Z}/k/kustomize`,D(),i.Z)})(t),(0,S.ZP)(t),(0,q.Z)(t),(e=t).listen(`/${a.Z}/kubectl/top/node`,F("kubectl"),i.Z),e.listen(`/${a.Z}/k/top/node`,F("k"),i.Z),e.listen(`/${a.Z}/kubectl/top/pod`,F("kubectl"),i.Z),e.listen(`/${a.Z}/k/top/pod`,F("k"),i.Z),(0,Q.ZP)(t),(0,H.ZP)(t),(t=>{t.listen(`/${a.Z}/_openstream`,(t=>V(void 0,void 0,void 0,(function*(){const e=t.argvNoOptions[t.argvNoOptions.indexOf("_openstream")+1],n="object"!=typeof t.execOptions.data||M.isBuffer(t.execOptions.data)?void 0:t.execOptions.data.headers;if(X("openstream",e),!t.execOptions.onInit)throw new Error("Internal Error: onInit required");return new Promise(((o,i)=>V(void 0,void 0,void 0,(function*(){try{yield(0,J.Cg)(t,e,{onInit:t.execOptions.onInit,onReady:t.execOptions.onReady,onExit:e=>{X("got exit from stream",e),t.execOptions.onExit&&t.execOptions.onExit(e),o(!0)}},n)}catch(t){i(t)}}))))}))),{requiresLocal:!0}),t.listen(`/${a.Z}/_fetchfile`,(({argvNoOptions:t,parsedOptions:e,REPL:n,execOptions:o})=>V(void 0,void 0,void 0,(function*(){const i=t[t.indexOf("_fetchfile")+1],r="object"!=typeof o.data||M.isBuffer(o.data)?void 0:o.data;return e.kustomize?{mode:"raw",content:yield et(n,i)}:{mode:"raw",content:yield(0,J.dc)(n,i,r)}}))),{requiresLocal:!0,flags:{boolean:["kustomize"]}})})(t),(t=>{(0,o.inBrowser)()&&!(0,o.hasProxy)()||t.catchall((t=>nt(t[0])||t[0]===a.Z&&nt(t[1])),(t=>(0,s.lN)(t)?(0,s.t$)("kubectl",t):(0,r.fF)(t)),1)})(t)}))}}]);