(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[2148,5719],{72148:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>c});var n=o(67294),s=o(51173),i=o(29512),r=o(37196),a=o(85719);const l=(0,s.i18n)("plugin-client-common");class c extends n.PureComponent{constructor(t){super(t),this._onCancel=this.onCancel.bind(this),this._onRevert=this.onRevert.bind(this),this._onDone=this.onDone.bind(this),this._setEdit=this.setEdit.bind(this),this._onContentChange=this.onContentChange.bind(this),this._onSaveFromEditor=this.onSaveFromEditor.bind(this),this._onCancelFromEditor=this.onCancelFromEditor.bind(this);const e=this.initialTextValue();this.state={isEdit:0===e.length,textValue:e,lastAppliedTextValue:e}}onCancel(t){this.onRevert(t,!1),this.removeOurselvesIfEmpty()}cancel(){return n.createElement(r.Z,{kind:"secondary",size:"small",className:"kui--tab-navigatable kui--commentary-button kui--commentary-cancel-button",onClick:this._onCancel},l("Cancel"))}onRevert(t,e=!0){t&&t.stopPropagation(),this.setState((t=>{const o=t.lastAppliedTextValue;return this.props.willUpdateResponse&&this.props.willUpdateResponse(o),{isEdit:e,textValue:o}}))}revert(){return n.createElement(r.Z,{kind:"tertiary",size:"small",className:"kui--tab-navigatable kui--commentary-button kui--commentary-revert-button",onClick:this._onRevert},l("Revert"))}removeOurselvesIfEmpty(){return""===this.state.textValue&&(this.props.willRemove&&this.props.willRemove(),!0)}onDone(t){t&&t.stopPropagation(),this.removeOurselvesIfEmpty()||this.setState((t=>(this.props.willUpdateCommand(`# ${t.textValue.replace(/\n/g,"\\n").replace(/\t/g,"\\t")}`),{isEdit:!1,lastAppliedTextValue:t.textValue})))}done(){return n.createElement(r.Z,{size:"small",className:"kui--tab-navigatable kui--commentary-button kui--commentary-done-button",onClick:this._onDone},l("Done"))}toolbar(){return n.createElement("div",{className:"kui--commentary-editor-toolbar fill-container flush-right"},this.done()," ",this.cancel()," ",this.revert())}setEdit(){this.setState({isEdit:!0})}card(){return n.createElement("span",{className:"kui--commentary-card",onDoubleClick:this._setEdit},n.createElement(i.Z,Object.assign({},this.props,{"data-is-editing":this.state.isEdit||void 0,header:this.state.isEdit&&l("Editing Comment as Markdown"),footer:this.state.isEdit&&this.toolbar()}),this.state.textValue,this.state.isEdit&&this.editor()))}onContentChange(t){this.setState({textValue:t}),this.props.willUpdateResponse&&this.props.willUpdateResponse(this.state.textValue)}onSaveFromEditor(t){this.onContentChange(t),this.onDone()}onCancelFromEditor(){this.onCancel()}initialTextValue(){return this.props.children||""}editor(){return n.createElement(a.default,{tabUUID:this.props.tabUUID,content:this.state.textValue,className:"kui--source-ref-editor kui--inverted-color-context",readonly:!1,simple:!0,onSave:this._onSaveFromEditor,onCancel:this._onCancelFromEditor,onContentChange:this._onContentChange,contentType:"markdown",scrollIntoView:this.props.isPartOfMiniSplit})}render(){return n.createElement("div",{className:"kui--commentary","data-is-editing":this.state.isEdit||void 0},this.card())}}},85719:(t,e,o)=>{"use strict";o.r(e),o.d(e,{default:()=>l});var n=o(67294),s=o(90112),i=o(51173),r=o(4766),a=o(94550);class l extends n.Component{constructor(t){super(t),this.state={cleaners:[],wrapper:n.createRef(),editor:void 0,catastrophicError:void 0}}static getDerivedStateFromError(t){return{catastrophicError:t}}componentDidCatch(t,e){console.error("catastrophic error in Editor",t,e)}shouldComponentUpdate(t,e){return!e.editor||!!e.catastrophicError}static getDerivedStateFromProps(t,e){return e.editor&&e.editor.getValue()!==t.content&&e.editor.setValue(t.content),e}componentWillUnmount(){this.destroyMonaco()}destroyMonaco(){this.state.cleaners.forEach((t=>t()))}static onChange(t,e){return()=>{t.onContentChange(e.getValue())}}registerKeyboardShortcuts(t){const{onSave:e,onCancel:o}=this.props;e&&(t.addCommand(s.KeyMod.CtrlCmd|s.KeyCode.KEY_S,(()=>{e(t.getValue())})),t.addCommand(s.KeyMod.Shift|s.KeyCode.Enter,(()=>{e(t.getValue())}))),o&&t.addCommand(s.KeyCode.Escape,(()=>{o(t.getValue())}))}initMonaco(t,e){const o=[];try{const n={value:t.content,readOnly:void 0===t.readonly||t.readonly,fontSize:t.fontSize||(0,r.Z)(),language:/^(ba)?sh$/.test(t.contentType)?"shell":t.contentType,simple:t.simple},c={theme:t.light?"vs":"vs-dark"},d=Object.assign((0,a.Z)(n),n,c),h=s.editor.create(e.wrapper.current,d);if(this.registerKeyboardShortcuts(h),d.readOnly&&t.simple){const t=void 0!==this.props.minHeight?this.props.minHeight:250;e.wrapper.current.style.height=Math.min(.3*window.innerHeight,Math.max(t,h.getContentHeight()))+"px"}e.wrapper.current.getValueForTests=()=>h.getValue(),h.onDidChangeModelContent(l.onChange(t,h)),d.readOnly||setTimeout((()=>h.focus()));const p=()=>{h.updateOptions({fontSize:(0,r.Z)()})};i.eventChannelUnsafe.on("/zoom",p),o.push((()=>i.eventChannelUnsafe.off("/zoom",p)));const u=()=>{h.layout()};i.eventBus.onTabLayoutChange(t.tabUUID,u),o.push((()=>i.eventBus.offTabLayoutChange(t.tabUUID,u))),o.push((()=>{h.dispose();const t=h.getModel();t&&t.dispose()})),this.setState({editor:h,cleaners:o})}catch(t){console.error("Error initing Monaco: ",t),this.setState({catastrophicError:t})}}componentDidMount(){!this.state.editor&&this.state.wrapper.current?this.initMonaco(this.props,this.state):this.props.scrollIntoView&&this.state.wrapper.current&&this.state.wrapper.current.scrollIntoView()}render(){if(this.state.catastrophicError)return n.createElement("div",{className:"oops"}," ",this.state.catastrophicError.toString());{const t="monaco-editor-wrapper"+(this.props.className?" "+this.props.className:"");return n.createElement("div",{className:t,ref:this.state.wrapper})}}}},94550:(t,e,o)=>{"use strict";o.d(e,{Z:()=>s});var n=o(4766);const s=t=>({automaticLayout:!0,minimap:{enabled:!1},codeLens:!1,quickSuggestions:!1,contextmenu:!1,scrollBeyondLastLine:!1,scrollBeyondLastColumn:2,scrollbar:{alwaysConsumeMouseWheel:!1},cursorStyle:"block",fontFamily:"var(--font-monospace)",fontSize:t.fontSize||(0,n.Z)(),glyphMargin:!t.readOnly&&!t.simple,links:!t.simple,folding:!t.simple||!/markdown|text|shell/i.test(t.language),lineNumbers:t.simple?"off":"on",wordWrap:t.simple?"on":void 0,renderFinalNewline:!t.simple,lineDecorationsWidth:t.simple?0:void 0})},4766:(t,e,o)=>{"use strict";function n(){return parseInt(getComputedStyle(document.querySelector("body")).getPropertyValue("font-size").replace(/px$/,""),10)}o.d(e,{Z:()=>n})}}]);