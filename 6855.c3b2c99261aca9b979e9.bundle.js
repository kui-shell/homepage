(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[6855,1330],{78953:(e,t,n)=>{"use strict";n.d(t,{z:()=>o,L:()=>r.LI});function o(e){return"kui-shell/v1"===e.apiVersion&&"File"===e.kind}var r=n(62062)},62062:(e,t,n)=>{"use strict";n.d(t,{LI:()=>f,AG:()=>g,kU:()=>v,Xy:()=>y,tH:()=>b});var o=n(11227),r=n.n(o),i=n(83859),s=n.n(i),a=n(26470),c=n(51173),l=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const d=r()("plugin-bash-like/fs/vfs"),p=[];function u(e,t){const n=e.mountPath.split(/\//).filter((e=>e)),o=t.mountPath.split(/\//).filter((e=>e));let r=0;const i=Math.min(n.length,o.length);for(;++r<i&&n[r]===o[r];);return 0===r||n.length===o.length?0:r===n.length?-1:o.length-n.length}function h(e){const t=p.findIndex((t=>t.mountPath===e.mountPath));t>=0?p.splice(t,1,e):(p.push(e),p.sort(u))}function m({REPL:e},t){return l(this,void 0,void 0,(function*(){const n=yield t(e),o=Array.isArray(n)?n:[n];yield Promise.all(o.map(h))}))}function f(e){return l(this,void 0,void 0,(function*(){if("function"!=typeof e)h(e);else{const t=(0,c.getCurrentTab)();if(t)m(t,e);else{let t=!1;c.eventBus.on("/tab/new",(n=>{t||(t=!0,m(n,e))}))}}}))}function g(e){return(0,a.isAbsolute)((0,c.expandHomeDir)(e))?e:(0,a.join)((0,c.cwd)(),e)}function v(e,t=!1){const n=(0,c.inBrowser)();e=g(e);return p.filter((o=>o.mountPath.startsWith(e)&&(!t||!n||o.isVirtual)))}function y(e,t=!1,n=!1){const o=(0,c.inBrowser)(),r=(e=g(e)).split(/\//),i=[];for(let e=1;e<r.length;e++)r[e]&&i.push("/"+r.slice(1,e+1).join("/"));let s;for(let e=0;e<p.length;e++){const n=p[e],{mountPath:r}=n;if(i.includes(r)&&(!t||!o||n.isVirtual)){s=n;break}}if(!s){if(n)for(let n=0;n<p.length;n++){const r=p[n];if(r.mountPath.startsWith(e)&&(!t||!o||r.isVirtual))return}s=p.find((e=>e.isLocal))}return d(`findMount ${e}->${s.mountPath}`),s}function b(e,t=!1){return 0===e.length?b([(0,c.cwd)()],t):e.map((e=>({filepaths:[s()(e)],mount:y(e,t)}))).filter((e=>void 0!==e.mount)).reduce(((e,t)=>(0===e.length||e[e.length-1].mount.mountPath!==t.mount.mountPath?e.push(t):e[e.length-1].filepaths.splice(e.length,0,...t.filepaths),e)),[])}},94550:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var o=n(4766);const r=e=>({automaticLayout:!0,minimap:{enabled:!1},codeLens:!1,quickSuggestions:!1,contextmenu:!1,scrollBeyondLastLine:!1,scrollBeyondLastColumn:2,scrollbar:{alwaysConsumeMouseWheel:!1},cursorStyle:"block",fontFamily:"var(--font-monospace)",fontSize:e.fontSize||(0,o.Z)(),glyphMargin:!e.readOnly&&!e.simple,links:!e.simple,folding:!e.simple||!/markdown|text|shell/i.test(e.language),lineNumbers:e.simple?"off":"on",wordWrap:e.simple?"on":void 0,renderFinalNewline:!e.simple,lineDecorationsWidth:e.simple?0:void 0})},4766:(e,t,n)=>{"use strict";function o(){return parseInt(getComputedStyle(document.querySelector("body")).getPropertyValue("font-size").replace(/px$/,""),10)}n.d(t,{Z:()=>o})},96855:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>R,isFocusable:()=>D});var o=n(67294),r=n(78953),i=n(51173),s=n(24107);class a extends o.PureComponent{constructor(e){super(e),this.state={isLoading:!0,command:e.command,react:void 0,spec:void 0,content:void 0,contentType:e.contentType},this.startLoading()}startLoading(){const e=e=>{this.setState({isLoading:!1,content:e})};"string"==typeof this.props.command?this.props.tab.REPL.qexec(this.props.command).then(e):Promise.resolve(this.props.command(this.props.tab,this.props.response,this.props.args)).then((e=>(0,i.isCommandStringContent)(e)?this.props.tab.REPL.qexec(e.contentFrom):e)).then((t=>{(0,i.isReactProvider)(t)?this.setState({isLoading:!1,react:t}):(0,i.isStringWithOptionalContentType)(t)?this.setState({isLoading:!1,content:t.content,contentType:t.contentType,spec:t.spec}):(0,i.isScalarContent)(t)?e(t.content):e(t)}))}render(){if(this.state.isLoading)return o.createElement(s.gb,null);const e=this.state.react?this.state.react:{spec:this.state.spec,content:this.state.content,contentType:this.state.contentType};return o.createElement(R,Object.assign({},this.props,{mode:e}))}}var c=n(26470),l=n(90112);const d=(0,i.i18n)("plugin-client-common","editor");function p(e,t){return{mode:"Clear",kind:"view",label:d("Clear"),command:()=>{e.setValue(""),t&&t()}}}var u=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const h=(0,i.i18n)("plugin-client-common","editor");var m=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const f=(0,i.i18n)("plugin-client-common","editor");var g=n(4766),v=n(11227);const y=n.n(v)()("plugins/editor/file-types"),b=(e,t)=>{const n=t||e.substring(0,e.indexOf(":"))||e;return y("language",e,t,n),"nodejs"===n||"app"===n||"composition"===n||"sequence"===n||"js"===n?"javascript":"ts"===n?"typescript":"md"===n?"markdown":"sh"===n?"shell":"yml"===n?"yaml":n};var w=n(94550),C=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};const T=(0,i.i18n)("plugin-client-common","editor");class S extends o.PureComponent{constructor(e){super(e),this.state={content:e.content,cleaners:[],editor:void 0,wrapper:void 0,catastrophicError:void 0}}static getDerivedStateFromError(e){return{catastrophicError:e}}componentDidCatch(e,t){console.error("catastrophic error in Editor",e,t)}static allClean(e){return{type:"info",text:T(e.readOnly?"isUpToDateReadonly":"isUpToDate")}}static error(e,t,...n){return{type:"error",text:T(t,...n)}}static getDerivedStateFromProps(e,t){return!t.editor&&t.wrapper?S.initMonaco(e,t):e.content!==t.content?{content:e.content,subscription:S.reinitMonaco(e,t)}:t}componentWillUnmount(){this.destroyMonaco()}destroyMonaco(){this.state.cleaners.forEach((e=>e()))}static isClearable(e,t){return(0,r.z)(e.response)&&!e.readOnly||!(0,r.z)(e.response)&&t.spec&&!1!==t.spec.clearable}static onChange(e,t,n){let o;return()=>{o&&(n.deltaDecorations(o,[]),o=void 0);const i=S.isClearable(e,t),s=[];if((0,r.z)(e.response)){const t=function(e,t,n,o){return{mode:"Save",kind:"view",label:h("saveLocalFile"),command:()=>u(this,void 0,void 0,(function*(){try{yield t.rexec(`fwrite ${t.encodeComponent(n.spec.fullpath)}`,{data:e.getValue()}),o(!0)}catch(e){o(!1)}}))}}(n,e.repl,e.response,(t=>{t?e.willUpdateToolbar(this.allClean(e),i?[p(n)]:void 0):e.willUpdateToolbar(this.error(e,"errorSaving"))}));s.push(t)}else if(t.spec&&t.spec.save){const{onSave:r}=t.spec.save;s.push({mode:"Save",label:t.spec.save.label||T("saveLocalFile"),kind:"drilldown",inPlace:!0,command:()=>C(this,void 0,void 0,(function*(){try{const t=yield r(n.getValue());if(t&&t.noToolbarUpdate||e.willUpdateToolbar(t&&t.toolbarText||this.allClean(e),i?[p(n)]:void 0),t&&t.command)return t.command}catch(t){const r=t;r.revealLine&&(n.revealLineInCenter(r.revealLine),o=n.deltaDecorations(o||[],[{range:new l.Range(r.revealLine,1,r.revealLine,1),options:{isWholeLine:!0,className:"kui--editor-line-highlight",glyphMarginClassName:"kui--editor-line-glyph"}}]));const i={type:"warning",text:T("isModified"),alerts:[{type:"error",title:T("errorApplying"),body:r.message}]};e.willUpdateToolbar(i,s,void 0)}}))})}if((0,r.z)(e.response)){const t=function(e,t,n,o){return{mode:"Revert",kind:"view",label:f("revert"),command:()=>m(this,void 0,void 0,(function*(){try{const e=(yield t.rexec(`vfs fstat ${t.encodeComponent(n.spec.fullpath)} --with-data --enoent-ok`)).content;o(!0,e.data)}catch(e){o(!1)}}))}}(0,e.repl,e.response,((t,o)=>{t?(n.setValue(o),e.willUpdateToolbar(this.allClean(e),i?[p(n)]:void 0)):e.willUpdateToolbar(this.error(e,"errorReverting"))}));s.push(t)}else if(t.spec&&t.spec.revert){const{onRevert:o}=t.spec.revert;s.push({mode:"Revert",label:t.spec.revert.label||T("revert"),kind:"view",command:()=>C(this,void 0,void 0,(function*(){try{const t=yield o();n.setValue(t),e.willUpdateToolbar(this.allClean(e),i?[p(n)]:void 0)}catch(t){console.error(t),e.willUpdateToolbar(this.error(e,"errorReverting"))}}))})}i&&s.push(p(n)),e.willUpdateToolbar({type:"warning",text:T("isModified")},s)}}static subscribeToChanges(e,t,n,o){if(e.willUpdateToolbar){const r=o&&e.response.toolbarText||!o&&this.allClean(e),i=e.response.toolbarText?[]:S.isClearable(e,t)?[p(n)]:void 0;return e.willUpdateToolbar(r,i),n.onDidChangeModelContent(S.onChange(e,t,n))}}static reinitMonaco(e,t){return t.editor.setValue(e.content.content),e.willUpdateToolbar(S.allClean(e),S.isClearable(e,e.content)?[p(t.editor)]:void 0),t.subscription&&t.subscription.dispose(),S.subscribeToChanges(e,e.content,t.editor,S.isReadOnly(e,t))}static isReadOnly(e,t){return!(0,r.z)(e.response)&&(!t.content.spec||!1!==t.content.spec.readOnly)&&(e.readOnly||!(0,r.z)(e.response)||!1)}static initMonaco(e,t){const n=[];try{const o={value:t.content.content,readOnly:S.isReadOnly(e,t),language:"text/plain"===t.content.contentType?b(t.content.contentType,(0,r.z)(e.response)?(0,c.extname)(e.response.spec.filepath).slice(1):void 0):t.content.contentType||void 0},s={theme:e.light?"vs":"vs-dark"},a=Object.assign((0,w.Z)(o),o,s),d=l.editor.create(t.wrapper,a),p=()=>{d.updateOptions({fontSize:(0,g.Z)()})};if(i.eventChannelUnsafe.on("/zoom",p),n.push((()=>i.eventChannelUnsafe.off("/zoom",p))),e.sizeToFit){const o=(e,n=Math.min(.4*window.innerHeight,Math.max(250,d.getContentHeight())))=>{t.wrapper.style.flexBasis=n+"px"};o();const r=new ResizeObserver((e=>{o(e[0].contentRect.width,e[0].contentRect.height),d.layout()}));r.observe(t.wrapper),n.push((()=>r.disconnect()));const s=()=>o();i.eventBus.onTabLayoutChange(e.tabUUID,s),n.push((()=>i.eventBus.offTabLayoutChange(e.tabUUID,s)))}else{const t=()=>{d.layout()};i.eventBus.onTabLayoutChange(e.tabUUID,t),n.push((()=>i.eventBus.offTabLayoutChange(e.tabUUID,t)))}d.clearDecorations=()=>{const e=[{range:new l.Range(1,1,1,1),options:{}}];d.__cloudshell_decorations=d.deltaDecorations(d.__cloudshell_decorations||[],e)},t.wrapper.getValueForTests=()=>d.getValue(),a.readOnly||setTimeout((()=>d.focus()));const u=S.subscribeToChanges(e,e.content,d,a.readOnly);return u&&n.push((()=>u.dispose())),n.push((()=>{d.dispose();const e=d.getModel();e&&e.dispose()})),{editor:d,cleaners:n,subscription:u}}catch(e){return console.error("Error initing Monaco: ",e),t.catastrophicError=e,t}}render(){return this.state.catastrophicError?o.createElement("div",{className:"oops"}," ",this.state.catastrophicError.toString()):o.createElement("div",{className:"code-highlighting"},o.createElement("div",{className:"monaco-editor-wrapper",ref:e=>this.setState({wrapper:e})}))}}class E extends o.PureComponent{constructor(e){super(e),this.state={cleaners:[],editor:void 0,wrapper:void 0,catastrophicError:void 0}}static getDerivedStateFromError(e){return{catastrophicError:e}}componentDidCatch(e,t){console.error("catastrophic error in Editor",e,t)}static getDerivedStateFromProps(e,t){return!t.editor&&t.wrapper?E.initMonaco(e,t):t}componentWillUnmount(){this.destroyMonaco()}destroyMonaco(){this.state.cleaners.forEach((e=>e()))}static initMonaco(e,t){const n=[];try{const o={readOnly:!0,renderSideBySide:e.renderSideBySide},s={theme:e.light?"vs":"vs-dark"},a=Object.assign((0,w.Z)(o),o,s),d="text/plain"===e.contentType?b(e.contentType,(0,r.z)(e.response)?(0,c.extname)(e.response.spec.filepath).slice(1):void 0):e.contentType||void 0,p=l.editor.createDiffEditor(t.wrapper,a);p.setModel({original:l.editor.createModel(e.originalContent,d),modified:l.editor.createModel(e.modifiedContent,d)}),p.onDidUpdateDiff((()=>{const e=p.getLineChanges();e&&0!==e.length&&p.revealLineInCenterIfOutsideViewport(e[0].originalStartLineNumber)}));const u=()=>{p.updateOptions({fontSize:(0,g.Z)()})};if(i.eventChannelUnsafe.on("/zoom",u),n.push((()=>i.eventChannelUnsafe.off("/zoom",u))),e.sizeToFit){const o=(e,n=Math.min(.4*window.innerHeight,Math.max(250,p.getModifiedEditor().getContentHeight())))=>{t.wrapper.style.flexBasis=n+"px"};o();const r=new ResizeObserver((e=>{o(e[0].contentRect.width,e[0].contentRect.height),p.layout()}));r.observe(t.wrapper),n.push((()=>r.disconnect()));const s=t=>{o(),t.isWidthConstrained?p.updateOptions({renderSideBySide:!1}):p.updateOptions({renderSideBySide:e.renderSideBySide})};i.eventBus.onTabLayoutChange(e.tabUUID,s),n.push((()=>i.eventBus.offTabLayoutChange(e.tabUUID,s)))}else{const t=t=>{p.layout(),t.isWidthConstrained?p.updateOptions({renderSideBySide:!1}):p.updateOptions({renderSideBySide:e.renderSideBySide})};i.eventBus.onTabLayoutChange(e.tabUUID,t),n.push((()=>i.eventBus.offTabLayoutChange(e.tabUUID,t)))}return t.wrapper.getValueForTests=()=>p.getModifiedEditor().getValue(),n.push((()=>{const e=p.getModel();e&&(e.original.dispose(),e.modified.dispose())})),{editor:p,cleaners:n}}catch(e){return console.error("Error initing Monaco: ",e),t.catastrophicError=e,t}}render(){return this.state.catastrophicError?o.createElement("div",{className:"oops"}," ",this.state.catastrophicError.toString()):o.createElement("div",{className:"code-highlighting"},o.createElement("div",{className:"monaco-editor-wrapper",ref:e=>this.setState({wrapper:e})}))}}var U=n(33678),x=n(25100);function L({content:e}){return o.createElement("div",{className:"padding-content scrollable scrollable-auto page-content"},o.createElement("div",{dangerouslySetInnerHTML:{__html:e}}))}var P=n(85255),M=n(81330);class R extends o.Component{constructor(e){super(e),this.state={mode:e.mode,isRendered:!1}}static getDerivedStateFromProps(e,t){return t&&t.isRendered&&t.mode===e.mode?t:Object.assign(t||{},{isRendered:!1,mode:e.mode})}shouldComponentUpdate(e){return e.isActive&&(!this.state||!this.state.isRendered)}componentDidUpdate(){this.props.isActive&&this.setState({isRendered:!0})}render(){if(!this.props.isActive)return o.createElement(o.Fragment,null);const{mode:e}=this.state,{tab:t,response:n,willUpdateToolbar:c}=this.props;if((0,i.isStringWithOptionalContentType)(e))return"text/html"===e.contentType?o.createElement(L,{content:e.content}):"text/markdown"===e.contentType?o.createElement(x.default,{tab:t,repl:t.REPL,fullpath:(0,r.z)(n)?n.spec.fullpath:void 0,source:e.content}):o.createElement(S,{content:e,readOnly:!1,willUpdateToolbar:c,response:n,repl:t.REPL,tabUUID:t.uuid});if((0,i.isStringDiffContent)(e))return o.createElement(E,{contentType:e.contentType,originalContent:e.content.a,modifiedContent:e.content.b,response:n,renderSideBySide:!0,tabUUID:t.uuid});if((0,i.isCommandStringContent)(e))return o.createElement(a,Object.assign({},this.props,{command:e.contentFrom,contentType:e.contentType}));if((0,i.isFunctionContent)(e))return o.createElement(a,Object.assign({},this.props,{command:e.content}));if((0,i.isScalarContent)(e)){if((0,i.isReactProvider)(e))return e.react({willUpdateToolbar:c});if((0,i.isRadioTable)(e.content)){const n=e.content;return o.createElement(s.C9.Consumer,null,(e=>o.createElement(M.default,{table:n,title:!e.disableTableTitle,repl:t.REPL})))}if((0,i.isTable)(e.content))return(0,U.Z)(t,t.REPL,e.content,!1);if((0,i.isHTML)(e.content))return o.createElement(P.Z,{content:e.content});console.error("Unsupported scalar content",e)}return o.createElement("div",{className:"oops"},"Unsupported content")}}function D(e){return"function"==typeof e.doFocus}},81330:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var o=n(67294),r=n(51173),i=n(92027);class s extends o.PureComponent{constructor(e){super(e),this.state={selectedIdx:e.table.defaultSelectedIdx}}render(){return o.createElement(i.Z,{toggle:"caret",actions:this.props.table.body.map(((e,t)=>({label:(0,r.radioTableCellToString)(e.cells[e.nameIdx]),isSelected:this.state.selectedIdx===t,handler:()=>(0,r.pexecInCurrentTab)(e.onSelect)}))),position:"left"})}}}}]);