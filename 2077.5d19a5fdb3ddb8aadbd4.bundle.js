(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[2077],{62062:(t,n,e)=>{"use strict";e.d(n,{LI:()=>v,AG:()=>m,kU:()=>g,Xy:()=>y,tH:()=>w});var i=e(11227),o=e.n(i),s=e(83859),r=e.n(s),c=e(26470),a=e(51173),u=function(t,n,e,i){return new(e||(e=Promise))((function(o,s){function r(t){try{a(i.next(t))}catch(t){s(t)}}function c(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}))};const l=o()("plugin-bash-like/fs/vfs"),d=[];function f(t,n){const e=t.mountPath.split(/\//).filter((t=>t)),i=n.mountPath.split(/\//).filter((t=>t));let o=0;const s=Math.min(e.length,i.length);for(;++o<s&&e[o]===i[o];);return 0===o||e.length===i.length?0:o===e.length?-1:i.length-e.length}function p(t){const n=d.findIndex((n=>n.mountPath===t.mountPath));n>=0?d.splice(n,1,t):(d.push(t),d.sort(f))}function h({REPL:t},n){return u(this,void 0,void 0,(function*(){const e=yield n(t),i=Array.isArray(e)?e:[e];yield Promise.all(i.map(p))}))}function v(t){return u(this,void 0,void 0,(function*(){if("function"!=typeof t)p(t);else{const n=(0,a.getCurrentTab)();if(n)h(n,t);else{let n=!1;a.eventBus.on("/tab/new",(e=>{n||(n=!0,h(e,t))}))}}}))}function m(t){return(0,c.isAbsolute)((0,a.expandHomeDir)(t))?t:(0,c.join)((0,a.cwd)(),t)}function g(t,n=!1){const e=(0,a.inBrowser)();t=m(t);return d.filter((i=>i.mountPath.startsWith(t)&&(!n||!e||i.isVirtual)))}function y(t,n=!1,e=!1){const i=(0,a.inBrowser)(),o=(t=m(t)).split(/\//),s=[];for(let t=1;t<o.length;t++)o[t]&&s.push("/"+o.slice(1,t+1).join("/"));let r;for(let t=0;t<d.length;t++){const e=d[t],{mountPath:o}=e;if(s.includes(o)&&(!n||!i||e.isVirtual)){r=e;break}}if(!r){if(e)for(let e=0;e<d.length;e++){const o=d[e];if(o.mountPath.startsWith(t)&&(!n||!i||o.isVirtual))return}r=d.find((t=>t.isLocal))}return l(`findMount ${t}->${r.mountPath}`),r}function w(t,n=!1){return 0===t.length?w([(0,a.cwd)()],n):t.map((t=>({filepaths:[r()(t)],mount:y(t,n)}))).filter((t=>void 0!==t.mount)).reduce(((t,n)=>(0===t.length||t[t.length-1].mount.mountPath!==n.mount.mountPath?t.push(n):t[t.length-1].filepaths.splice(t.length,0,...n.filepaths),t)),[])}},82077:(t,n,e)=>{"use strict";e.r(n),e.d(n,{default:()=>y});var i=e(12993),o=e(51173),s=e(62062),r=e(67435),c=e(7716),a=function(t,n,e,i){return new(e||(e=Promise))((function(o,s){function r(t){try{a(i.next(t))}catch(t){s(t)}}function c(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}))};const u=(0,o.i18n)("plugin-bash-like");function l(t,n,e,o){const{mode:s}=t;return`${e?"d":o?"l":n?"-":"s"}${s&i.constants.S_IRUSR?"r":"-"}${s&i.constants.S_IWUSR?"w":"-"}${s&i.constants.S_IXUSR?"x":"-"}${s&i.constants.S_IRGRP?"r":"-"}${s&i.constants.S_IWGRP?"w":"-"}${s&i.constants.S_IXGRP?"x":"-"}${s&i.constants.S_IROTH?"r":"-"}${s&i.constants.S_IWOTH?"w":"-"}${s&i.constants.S_IXOTH?"x":"-"}`}function d(t){return a(this,void 0,void 0,(function*(){return new Promise(((n,e)=>{(0,i.stat)(t,((t,i)=>{t?"ENOENT"===t.code||"ENOTDIR"===t.code?n(void 0):e(t):n(i)}))}))}))}const f=()=>!1,p=()=>!0;var h=e(7716);var v=e(48764).Buffer,m=function(t,n,e,i){return new(e||(e=Promise))((function(o,s){function r(t){try{a(i.next(t))}catch(t){s(t)}}function c(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,c)}a((i=i.apply(t,n||[])).next())}))};class g{constructor(){this.mountPath="/",this.isLocal=!0,this.isVirtual=!1}ls(t,n){return m(this,void 0,void 0,(function*(){return function({tab:t,argvNoOptions:n,parsedOptions:s}){return a(this,void 0,void 0,(function*(){const a=e(79644),h=n.slice(n.indexOf("kuiglob")+1).map(o.expandHomeDir).map((t=>t.replace(/([^\\])"/g,"$1"))),v=0===h.length?[]:yield Promise.all(h.map(d)),m=v.map((t=>t&&t.isDirectory())),g=h.filter(((t,n)=>!s.d||!m[n])).reduce(((t,n,e)=>{if(!s.d){if(m[e])return t.push(n.endsWith("/")?`${n}*`:`${n}/*`),t;if(n.endsWith("*"))return t.push(n),t.push(`${n}/*`),t}return t.push(n),t}),[]),y=s.l||s.C,w=0===g.length&&h.length>0?[]:yield a(0===g.length?["*"]:g,{onlyFiles:!1,suppressErrors:!0,expandDirectories:!1,followSymbolicLinks:!1,dot:s.a||s.all,stats:y,objectMode:!y,cwd:(0,o.isHeadless)()?c.cwd():t.state.cwd}),O=s.d?h.map(((t,n)=>m[n]?{name:t,path:t,dirent:{isFile:f,isSymbolicLink:f,isDirectory:p},stats:v[n]}:void 0)).filter((t=>t)):[],x=w.concat(O);if(0===x.length&&!h.some((t=>/\*/.test(t)))&&!m.some((t=>t))){const t=new Error(u("No such file or directory",h.join(" ")));throw t.code=404,t}const P=(0,r.userInfo)();return x.map((({name:t,path:n,dirent:e,stats:o})=>{const r=e.isFile(),c=e.isDirectory(),a=e.isSymbolicLink(),u=o&&!!(o.mode&(i.constants.S_IXUSR|i.constants.S_IXGRP|i.constants.S_IXOTH)),d=!r&&!c&&!a;return{name:t,path:n,nameForDisplay:g.length>1?n:t,stats:o,dirent:{isFile:r,isDirectory:c,isSymbolicLink:a,isExecutable:u,isSpecial:d,permissions:s.l?l(o,r,c,a):"",username:o&&P.uid===o.uid?P.username:""}}}))}))}({tab:t.tab,argvNoOptions:["kuiglob",...n],parsedOptions:t.parsedOptions})}))}cp(t){return m(this,void 0,void 0,(function*(){return t.REPL.qexec(`sendtopty ${t.command.replace(/^vfs/,"")}`,void 0,void 0,Object.assign(t.execOptions,{quiet:!t.parsedOptions.i&&t.execOptions.quiet}))}))}rm(t){return m(this,void 0,void 0,(function*(){return yield t.REPL.qexec(`sendtopty ${t.command.replace(/^vfs/,"")}`,void 0,void 0,Object.assign(t.execOptions,{quiet:!1})),!0}))}fstat(t,n,e,s){return m(this,void 0,void 0,(function*(){return(({argvNoOptions:t,parsedOptions:n})=>{const e=t[1],{resolved:s,viewer:r="open"}=(0,o.findFileWithViewer)((0,o.expandHomeDir)(e)),c=s.replace(new RegExp(`^${h.env.HOME}`),"~");return new Promise(((t,o)=>{const a=i=>{if("ENOENT"===i.code){n["enoent-ok"]&&t({viewer:r,filepath:e,fullpath:c,isDirectory:!1,data:""});const s=new Error(i.message);s.stack=i.stack,s.code=404,o(s)}else o(i)};n["with-data"]?(0,i.readFile)(s,((n,i)=>{if(n)return a(n);t({viewer:r,filepath:e,fullpath:c,data:i.toString(),isDirectory:!1})})):(0,i.stat)(s,((n,i)=>{if(n)return a(n);t({viewer:r,filepath:e,fullpath:c,isDirectory:i.isDirectory()})}))}))})({argvNoOptions:["fstat",n],parsedOptions:{"with-data":e,"enoent-ok":s}})}))}fslice(t,n,e){return m(this,void 0,void 0,(function*(){const{resolved:s}=(0,o.findFileWithViewer)((0,o.expandHomeDir)(t));return new Promise(((t,o)=>{(0,i.open)(s,"r",((r,c)=>{r?o(r):(0,i.stat)(s,((s,r)=>{s&&o(s);try{if(n>=r.size)o(new Error("local fslice: reach file end"));else{const s=e<=r.size?e:r.size;(0,i.read)(c,v.alloc(s),0,s,n,((n,e,i)=>{n?o(n):t(i.toString())}))}}catch(s){o(s)}}))}))}))}))}mkdir(t){return m(this,void 0,void 0,(function*(){yield t.REPL.qexec(`sendtopty ${t.command.replace(/^vfs/,"")}`,void 0,void 0,Object.assign(t.execOptions,{quiet:!1}))}))}rmdir(t){return m(this,void 0,void 0,(function*(){yield t.REPL.qexec(`sendtopty ${t.command.replace(/^vfs/,"")}`,void 0,void 0,Object.assign(t.execOptions,{quiet:!1}))}))}grep(t){return m(this,void 0,void 0,(function*(){return t.REPL.qexec(`sendtopty ${t.command.replace(/^vfs/,"")}`,void 0,void 0,Object.assign(t.execOptions,{quiet:!1}))}))}zip(t,n,e){return m(this,void 0,void 0,(function*(){const i=t.parsedOptions.S||t.parsedOptions.suffix;yield Promise.all(n.map((n=>t.REPL.qexec(`sendtopty ${e} ${t.argv.filter((t=>/^-/.test(t)))} ${i?`-S ${i}`:""} ${(0,o.encodeComponent)(n)}`,void 0,void 0,Object.assign(t.execOptions,{quiet:!1})))))}))}gzip(...t){return this.zip(t[0],t[1],"gzip")}gunzip(...t){return this.zip(t[0],t[1],"gunzip")}}const y=()=>m(void 0,void 0,void 0,(function*(){(0,s.LI)(new g)}))}}]);