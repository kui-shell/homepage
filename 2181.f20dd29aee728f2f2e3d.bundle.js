(self.webpackChunkkui_shell=self.webpackChunkkui_shell||[]).push([[2181],{63124:(e,t,s)=>{"use strict";s.d(t,{Y:()=>n});var i=s(70655),a=s(67294);const n=e=>{var{children:t,className:s}=e,n=(0,i.__rest)(e,["children","className"]);return a.createElement("caption",Object.assign({className:s},n),t)};n.displayName="Caption"},23912:(e,t,s)=>{"use strict";s.d(t,{Th:()=>R});var i=s(70655),a=s(67294),n=s(38296),r=s(26246),l=s(40400);const o=(0,l.IU)({name:"HelpIcon",height:1024,width:1024,svgPath:"M521.3,576 C627.5,576 713.7,502 713.7,413.7 C713.7,325.4 627.6,253.6 521.3,253.6 C366,253.6 334.5,337.7 329.2,407.2 C329.2,414.3 335.2,416 343.5,416 L445,416 C450.5,416 458,415.5 460.8,406.5 C460.8,362.6 582.9,357.1 582.9,413.6 C582.9,441.9 556.2,470.9 521.3,473 C486.4,475.1 447.3,479.8 447.3,521.7 L447.3,553.8 C447.3,570.8 456.1,576 472,576 C487.9,576 521.3,576 521.3,576 M575.3,751.3 L575.3,655.3 C575.313862,651.055109 573.620137,646.982962 570.6,644 C567.638831,640.947672 563.552355,639.247987 559.3,639.29884 L463.3,639.29884 C459.055109,639.286138 454.982962,640.979863 452,644 C448.947672,646.961169 447.247987,651.047645 447.29884,655.3 L447.29884,751.3 C447.286138,755.544891 448.979863,759.617038 452,762.6 C454.961169,765.652328 459.047645,767.352013 463.3,767.30116 L559.3,767.30116 C563.544891,767.313862 567.617038,765.620137 570.6,762.6 C573.659349,759.643612 575.360354,755.553963 575.3,751.3 M512,896 C300.2,896 128,723.9 128,512 C128,300.3 300.2,128 512,128 C723.8,128 896,300.2 896,512 C896,723.8 723.7,896 512,896 M512.1,0 C229.7,0 0,229.8 0,512 C0,794.2 229.8,1024 512.1,1024 C794.4,1024 1024,794.3 1024,512 C1024,229.7 794.4,0 512.1,0",yOffset:0,xOffset:0});var c=s(62308),d=s(68065);const h=({children:e,info:t,className:s,variant:i="tooltip",popoverProps:l,tooltipProps:h,ariaLabel:m})=>a.createElement("div",{className:(0,n.i)(r.Z.tableColumnHelp,s)},"string"==typeof e?a.createElement(d.cE,null,e):e,a.createElement("span",{className:(0,n.i)(r.Z.tableColumnHelpAction)},"tooltip"===i?a.createElement(c.Tooltip,Object.assign({content:t},h),a.createElement(c.Button,{variant:"plain","aria-label":m||"string"==typeof t&&t||"More info"},a.createElement(o,{noVerticalAlign:!0}))):a.createElement(c.Popover,Object.assign({bodyContent:t},l),a.createElement(c.Button,{variant:"plain","aria-label":m||"string"==typeof t&&t||"More info"},a.createElement(o,{noVerticalAlign:!0})))));h.displayName="HeaderCellInfoWrapper";const m=(0,l.IU)({name:"LongArrowAltUpIcon",height:512,width:256,svgPath:"M88 166.059V468c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12V166.059h46.059c21.382 0 32.09-25.851 16.971-40.971l-86.059-86.059c-9.373-9.373-24.569-9.373-33.941 0l-86.059 86.059c-15.119 15.119-4.411 40.971 16.971 40.971H88z",yOffset:0,xOffset:0}),p=(0,l.IU)({name:"LongArrowAltDownIcon",height:512,width:256,svgPath:"M168 345.941V44c0-6.627-5.373-12-12-12h-56c-6.627 0-12 5.373-12 12v301.941H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.569 9.373 33.941 0l86.059-86.059c15.119-15.119 4.411-40.971-16.971-40.971H168z",yOffset:0,xOffset:0}),u=(0,l.IU)({name:"ArrowsAltVIcon",height:512,width:256,svgPath:"M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z",yOffset:0,xOffset:0});var f;!function(e){e.asc="asc",e.desc="desc"}(f||(f={}));const v=e=>{var{children:t=null,className:s="",isSortedBy:l=!1,onSort:o=null,sortDirection:c="",type:h="button"}=e,v=(0,i.__rest)(e,["children","className","isSortedBy","onSort","sortDirection","type"]);let g;return g=l?c===f.asc?m:p:u,a.createElement("button",Object.assign({},v,{type:h,className:(0,n.i)(s,r.Z.tableButton),onClick:e=>o&&o(e)}),a.createElement("div",{className:(0,n.i)(s,r.Z.tableButtonContent)},a.createElement(d.cE,null,t),a.createElement("span",{className:(0,n.i)(r.Z.tableSortIndicator)},a.createElement(g,null))))};v.displayName="SortColumn";var g=s(83668);const y=(e,{columnIndex:t,column:s,property:i,className:l,ariaLabel:o})=>{const{extraParams:{sortBy:c,onSort:d}}=s,h={columnIndex:t,column:s,property:i},m=c&&t===c.index;return{className:(0,n.i)(r.Z.tableSort,m&&r.Z.modifiers.selected,l),"aria-sort":m?`${c.direction}ending`:"none",children:a.createElement(v,{isSortedBy:m,sortDirection:m?c.direction:"",onSort:function(e){let s;s=m&&c.direction===f.asc?f.desc:f.asc,d&&d(e,t,s,h)},"aria-label":o},e)}};var b=s(5616),S=s(1082),E=s(22546),_=s(89409),x=s(35224);const w=e=>{var{children:t,className:s,component:l="th",scope:o="col",textCenter:c=!1,sort:d=null,modifier:m,select:p=null,tooltip:u="",onMouseEnter:f=(()=>{}),width:v,visibility:w,innerRef:R,info:C}=e,N=(0,i.__rest)(e,["children","className","component","scope","textCenter","sort","modifier","select","tooltip","onMouseEnter","width","visibility","innerRef","info"]);const[A,k]=a.useState(!1);let O=null;d&&(O=d.isFavorites?(e=>()=>y(a.createElement(g.ZP,{"aria-hidden":!0}),{columnIndex:e.columnIndex,className:r.Z.modifiers.favorite,ariaLabel:"Sort favorites",column:{extraParams:{sortBy:e.sortBy,onSort:null==e?void 0:e.onSort}}}))({onSort:null==d?void 0:d.onSort,columnIndex:d.columnIndex,sortBy:d.sortBy})():y(t,{columnIndex:d.columnIndex,column:{extraParams:{sortBy:d.sortBy,onSort:null==d?void 0:d.onSort}}}));const F=p?(0,b.e)(t,{column:{extraParams:{onSelect:null==p?void 0:p.onSelect,selectVariant:"checkbox",allRowsSelected:p.isSelected}}}):null,I=v?(0,S.d)(v)():null,D=w?(0,E.A)(...w.map((e=>E.E[e])))():null;let T=(null==O?void 0:O.children)||(null==F?void 0:F.children)||t,L=null;C&&(L=(({tooltip:e,tooltipProps:t,popover:s,popoverProps:i,className:n,ariaLabel:l})=>o=>({className:r.Z.modifiers.help,children:e?a.createElement(h,{variant:"tooltip",info:e,tooltipProps:t,ariaLabel:l,className:n},o):a.createElement(h,{variant:"popover",info:s,popoverProps:i,ariaLabel:l,className:n},o)}))(C)(T),T=L.children);const q=(0,_.d)(O,F,I,D,L),{children:P=null,isVisible:G=null,className:M="",component:j=l}=q,H=(0,i.__rest)(q,["children","isVisible","className","component"]),W=a.createElement(j,Object.assign({onMouseEnter:null!==u?e=>{e.target.offsetWidth<e.target.scrollWidth?!A&&k(!0):A&&k(!1),f(e)}:f,scope:"th"===l&&t?o:null,ref:R,className:(0,n.i)(s,c&&r.Z.modifiers.center,m&&r.Z.modifiers[m],M)},H,N),T);return null!==u&&(""!==u||"string"==typeof t)&&A?a.createElement(x.u,{content:u||""===u&&t,isVisible:!0},W):W},R=a.forwardRef(((e,t)=>a.createElement(w,Object.assign({},e,{innerRef:t}))));R.displayName="Th"},58240:(e,t,s)=>{"use strict";s.d(t,{h:()=>o});var i=s(70655),a=s(67294),n=s(38296),r=s(26246);const l=e=>{var{children:t,className:s,noWrap:l=!1,innerRef:o}=e,c=(0,i.__rest)(e,["children","className","noWrap","innerRef"]);return a.createElement("thead",Object.assign({className:(0,n.i)(s,l&&r.Z.modifiers.nowrap),ref:o},c),t)},o=a.forwardRef(((e,t)=>a.createElement(l,Object.assign({},e,{innerRef:t}))));o.displayName="Thead"},48657:(e,t,s)=>{"use strict";s.d(t,{Fq:()=>a,Nq:()=>l,Do:()=>o,hp:()=>c});var i=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function r(e){try{o(i.next(e))}catch(e){n(e)}}function l(e){try{o(i.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,l)}o((i=i.apply(e,t||[])).next())}))};function a(e,t){return i(this,void 0,void 0,(function*(){delete e.originatingCommand,delete e.kuiRawData,delete e.isKubeResource;const{safeDump:i}=yield s.e(3320).then(s.t.bind(s,93320,23)),a=i(e);return yield t.REPL.qexec(`cat <<"EOF" | kubectl apply -f -\n${a}\nEOF`)}))}function n(e,t){return i(this,void 0,void 0,(function*(){return(yield t.REPL.qexec(`kubectl get deployments -n ${e.destination_workload_namespace} ${e.destination_workload} -o json`)).spec.template.metadata.labels}))}function r(e,t,s){return i(this,void 0,void 0,(function*(){return(yield s.REPL.qexec(`kubectl get svc -n ${t} ${e} -o json`)).spec.ports[0].port}))}function l(e,t){var s={};s={apiVersion:"networking.istio.io/v1alpha3",kind:"DestinationRule",metadata:{name:e.service_name+"."+e.service_namespace+".iter8-experiment",namespace:e.service_namespace,labels:{"iter8-tools/host":e.service_name,"iter8-tools/role":"stable"}},spec:{host:e.service_name,subsets:[]}},setTimeout((()=>i(this,void 0,void 0,(function*(){for(const[i,a]of Object.entries(e)){if("service_name"===i)continue;if("service_namespace"===i)continue;if("edgeService"===i)continue;if("hostGateways"===i)continue;let[e]=yield Promise.all([n(a.version_labels,t)]);s.spec.subsets.push({labels:e,name:i})}console.log("Applying Destination Rule"),a(s,t),function(e,t,s){var n={};if(n={apiVersion:"networking.istio.io/v1alpha3",kind:"VirtualService",metadata:{name:t.service_name+"."+t.service_namespace+".iter8-experiment",namespace:t.service_namespace,labels:{"iter8-tools/host":t.service_name,"iter8-tools/role":"stable"}},spec:{hosts:[t.service_name],gateways:["mesh"],http:[{route:[]}]}},!0===t.edgeService)for(var l=0;l<t.hostGateways.length;l++)n.spec.hosts.push(t.hostGateways[l].name),n.spec.gateways.push(t.hostGateways[l].gateway);setTimeout((()=>i(this,void 0,void 0,(function*(){const[i]=yield Promise.all([r(t.service_name,t.service_namespace,s)]),l=e.spec.subsets;n.spec.http[0].route=[];for(let s=0;s<l.length;s++)n.spec.http[0].route.push({destination:{host:e.spec.host,subset:l[s].name,port:{number:i}},weight:t[l[s].name].traffic_percentage});console.log("Applying Virtual Service"),a(n,s)}))))}(s,e,t)}))))}function o(e){let t=[];for(let s=0;s<e.length;s++)t.push(e[s].split);return 100===t.reduce(((e,t)=>e+t),0)}function c(e,t,s){let i={service_name:t,service_namespace:e};for(let t=0;t<s.length;t++)i[`${s[t].version}`]={version_labels:{destination_workload_namespace:e,destination_workload:s[t].version},traffic_percentage:s[t].split};return i}},52181:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var i=s(67294),a=s(51173),n=s(24107),r=s(63124),l=s(58240),o=s(86151),c=s(23912),d=s(3134),h=s(54976),m=s(73827),p=s(62308),u=s(7716);const f=s(26470);class v{constructor(e){this.data={},this.url="",this.url="",void 0===u.env.ITER8_ANALYTICS_URL?(console.log("URL not defined"),this.url="http://0.0.0.0:8080/assessment",console.log(this.url)):(console.log("URL defined"),this.url=f.join(u.env.ITER8_ANALYTICS_URL,"assessment"),console.log(this.url)),this.data=e}getAnalyticsAssessment(){const e=this.data,t=this.url;return new Promise((function(s,i){const a=new XMLHttpRequest;a.open("POST",t,!0),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify(e)),a.onreadystatechange=function(){if(4===a.readyState)if(200===a.status){console.log("Request processed successfully");const e=a.responseText,t=JSON.stringify(e);s(t)}else i(a.status),console.log("Request failed");else console.log("Request processing going on")},console.log("Request sent succesfully")}))}}class g{constructor(){this.metricDisplayNames={iter8_request_count:"Request Count",iter8_total_latency:"Total Latency (sec)",iter8_error_count:"Error Count",iter8_mean_latency:"Mean Latency (sec)",iter8_error_rate:"Error Rate"},this.algoDisplayNames={uniform:"Uniform Split",random:"Random Split",progressive:"Progressive Split",top_2:"Top Two Split"},this.advancedStatisticsNames={"Credible Interval":"credible_interval"}}getMetricName(e){return e in this.metricDisplayNames?this.metricDisplayNames[e]:(console.log("Metric name is not registed in the dictionary."),e)}getAlgoName(e){return e in this.algoDisplayNames?this.algoDisplayNames[e]:(console.log("Algorithm name is not registered in the dictionary."),e)}}var y=s(54329),b=s(48657);const S=i.lazy((()=>s.e(7229).then(s.bind(s,47229))));function E(e,t=4){return null==e?null:parseFloat(e.toFixed(t))}const _=e=>i.createElement(i.Fragment,null,e.title&&i.createElement(r.Y,null,e.title),i.createElement(l.h,null,i.createElement(o.Tr,null,e.headers.map((e=>i.createElement(c.Th,{key:e.key},e.header))))),i.createElement(d.p,null,e.rows.map((e=>i.createElement(o.Tr,{key:e.id},e.cells.map((e=>i.createElement(h.Td,{key:e.id},i.createElement("div",null,e.value)))))))));class x extends i.Component{constructor(e){super(e),this._isMounted=!1,this.winner="",this.algoList=[],this.trafficRecs=[],this.deployList=[],this.notifKey=0,this.basicStatsHeader=[],this.basicStatsRows=[],this.advancedStatisticsObject={},this.advancedStatisticsNames={},this.advancedStatiticsHeaders=[],this.handleAlgoChange=e=>{this.setState({selectedAlgo:e}),this.getTrafficRecs(e,this.state.experimentResult),this.handleReset()},this.handleTrafficChange=(e,t)=>{let s;for(let i=0;i<this.state.trafficSplit.length;i++)if(this.state.trafficSplit[i].version===t){s=[...this.state.trafficSplit],s[i]=Object.assign(Object.assign({},s[i]),{split:e});break}(0,b.Do)(s)?this.setState({trafficSplit:s,trafficErr:!1}):this.setState({trafficSplit:s,trafficErr:!0})},this.args=e,this.state={selectedAlgo:"progressive",trafficSplit:[{version:"",split:0}],currentSplit:[],trafficErr:!1,notifyUser:!1,notifyTime:"",experimentCreated:!1,haveResults:!1,experimentRequest:null,experimentResult:null,haveAdvancedStatistics:!1,haveCriteriaComparison:!1,selectedAdvancedStatistic:"Credible Interval",showAdvancedStatistics:!1,advancedStatisticsRows:[],hasExperimentEnded:!1,experimentDecision:"rollback",endExperimentWinner:"",chartData:[],chartOptions:{},edgeService:!0,hostGateways:[]},this.handleReset=this.handleReset.bind(this),this.handleApply=this.handleApply.bind(this),this.handleCloseNotif=this.handleCloseNotif.bind(this),this.handleGetAssessment=this.handleGetAssessment.bind(this),this.toggleAdvancedStatistics=this.toggleAdvancedStatistics.bind(this),this.getAdvancedStatistics=this.getAdvancedStatistics.bind(this),this.endExperiment=this.endExperiment.bind(this)}componentDidMount(){console.log("Mounted Decision tab"),this._isMounted=!0,a.eventChannelUnsafe.on("/get/decision",(e=>{this.setState({edgeService:e.edgeServiceInformation.edgeService,hostGateways:e.edgeServiceInformation.hostGateways,experimentCreated:!0,experimentRequest:e})}))}componentWillUnmount(){console.log("Unmounted Decision"),this._isMounted=!1}getWinAnalysis(e){if(e.winner_assessment.winning_version_found){const t=E(e.winner_assessment.probability_of_winning_for_best_version,4);this.winner=`Version: ${e.winner_assessment.current_best_version} is the winner with ${t} probability of winning`}else this.winner="Do not have enough data to determine winner"}getWinProbAndBasicStats(e){const t=[];this.basicStatsHeader=[{header:"Deployment",key:"version"},{header:"Type",key:"type"},{header:"Request Count",key:"count"},{header:"Win Probability",key:"winprob"},{header:"Roll Back Recommended",key:"rollback"}];const s=e.baseline_assessment;this.basicStatsRows=[],this.basicStatsRows.push({id:s.id,version:s.id,type:"Baseline",count:s.request_count,winprob:E(s.win_probability,4),rollback:"Does not apply"}),t.push(s.id);const i=e.candidate_assessments;for(let e=0;e<i.length;e++)this.basicStatsRows.push({id:i[e].id,version:i[e].id,type:"Candidate",count:i[e].request_count,winprob:E(i[e].win_probability,4),rollback:i[e].rollback.toString()}),t.push(i[e].id)}getAlgo(e){const t=e.traffic_split_recommendation,s=[],i=new g;Object.getOwnPropertyNames(t).forEach((e=>{const t=i.getAlgoName(e);s.push({id:e,text:t})})),this.algoList=s}getTrafficRecs(e,t){const s=t.traffic_split_recommendation;let i={};const a=[];return Object.getOwnPropertyNames(s).forEach((t=>{t===e&&(i=s[t])})),Object.getOwnPropertyNames(i).forEach((e=>{a.push({version:e,split:i[e]})})),this.trafficRecs=a,a}haveCriteriaComparison(){return!!this.state.experimentRequest.criteria.length}fillchartDataTemplate(){const e=this.state.experimentResult.baseline_assessment.criterion_assessments,t=[],s={};for(let i=0;i<e.length;i++){const a=JSON.parse(JSON.stringify(y.t)),n=(new Date).toISOString();a.xaxis.categories.push(n),s[e[i].metric_id]=a;const r={title:e[i].metric_id,data:[]};({}).hasOwnProperty.call(this.state.experimentRequest.criteria[i],"threshold")&&("absolute"===this.state.experimentRequest.criteria[i].threshold.type?r.data.push({name:"threshold",data:[E(this.state.experimentRequest.criteria[i].threshold.value,4)]}):r.data.push({name:"threshold",data:[E((1+this.state.experimentRequest.criteria[i].threshold.value)*e[i].statistics.value)]})),r.data.push({name:this.state.experimentResult.baseline_assessment.id,data:[E(e[i].statistics.value)]}),t.push(r)}const i=this.state.experimentResult.candidate_assessments;for(let e=0;e<i.length;e++){const s=i[e].id;for(let a=0;a<i[e].criterion_assessments.length;a++){const n=i[e].criterion_assessments[a];t[a].data.push({name:s,data:[E(n.statistics.value)]})}}this.setState({chartData:t,chartOptions:s})}getChartData(){if(0===this.state.chartData.length)this.fillchartDataTemplate();else{const e=this.state.experimentResult.baseline_assessment.criterion_assessments,t=JSON.parse(JSON.stringify(this.state.chartData)),s=JSON.parse(JSON.stringify(this.state.chartOptions));for(let i=0;i<e.length;i++){const a=(new Date).toISOString();s[e[i].metric_id].xaxis.categories.push(a),{}.hasOwnProperty.call(this.state.experimentRequest.criteria[i],"threshold")&&("absolute"===this.state.experimentRequest.criteria[i].threshold.type?t[i].data[0].data.push(E(t[i].data[0].data[0])):t[i].data[0].data.push(E((1+this.state.experimentRequest.criteria[i].threshold.value)*e[i].statistics.value))),t[i].data[1].data.push(E(e[i].statistics.value))}const i=this.state.experimentResult.candidate_assessments;for(let e=0;e<i.length;e++)for(let s=0;s<i[e].criterion_assessments.length;s++){const a=i[e].criterion_assessments[s];t[s].data[e+2].data.push(E(a.statistics.value))}this.setState({chartData:t,chartOptions:s})}}haveAdvancedStatistics(){if(this.state.experimentRequest.criteria.length){this.advancedStatiticsHeaders=[{header:"Deployment",key:"version"}];const e=new g,t=JSON.parse(JSON.stringify(this.state.experimentRequest.metric_specs.ratio_metrics));for(let e=0;e<t.length;e++)t[e]=t[e].name;const s=this.state.experimentRequest.criteria;for(let i=0;i<s.length;i++)t.includes(s[i].metric_id)&&this.advancedStatiticsHeaders.push({header:e.getMetricName(s[i].metric_id),key:s[i].metric_id});return this.advancedStatiticsHeaders.length>1}return!1}parseAdvancedStatisticsValues(e,t){return"credible_interval"===e||"improvement_over_baseline"===e?JSON.stringify([E(t.lower),E(t.upper)]):E(t)}createadvancedStatisticsObject(){const e=new g;this.advancedStatisticsNames=e.advancedStatisticsNames;const t=[];t.push({id:this.state.experimentResult.baseline_assessment.id,version:this.state.experimentResult.baseline_assessment.id});const s=this.state.experimentResult.candidate_assessments;for(let e=0;e<s.length;e++)t.push({id:s[e].id,version:s[e].id});const i=[];i.push(this.state.experimentResult.baseline_assessment.criterion_assessments);for(let e=0;e<this.state.experimentResult.candidate_assessments.length;e++)i.push(this.state.experimentResult.candidate_assessments[e].criterion_assessments);const a={};for(let e=0;e<i.length;e++)for(let s=0;s<i[e].length;s++)if({}.hasOwnProperty.call(i[e][s].statistics,"ratio_statistics")&&null!=i[e][s].statistics.ratio_statistics){const n={improvement_over_baseline:{lower:-1*Math.random(),upper:Math.random()},probability_of_beating_baseline:Math.random(),probability_of_being_best_version:Math.random(),credible_interval:{lower:i[e][s].statistics.ratio_statistics.credible_interval.lower,upper:i[e][s].statistics.ratio_statistics.credible_interval.upper}};let r=[];r=Object.values(this.advancedStatisticsNames);for(let l=0;l<r.length;l++)({}).hasOwnProperty.call(a,r[l])||(a[r[l]]=JSON.parse(JSON.stringify(t))),a[r[l]][e][i[e][s].metric_id]=this.parseAdvancedStatisticsValues(r[l],n[r[l]])}this.advancedStatisticsObject=a}getAdvancedStatistics(e){this.setState({selectedAdvancedStatistic:e}),this.setState({advancedStatisticsRows:this.advancedStatisticsObject[this.advancedStatisticsNames[e]]})}toggleAdvancedStatistics(){this.setState({showAdvancedStatistics:!this.state.showAdvancedStatistics})}handleGetAssessment(){if(this.setState({haveResults:!1}),null!==this.state.experimentResult){const e=this.state.experimentRequest;e.last_state=this.state.experimentResult.last_state,this.setState({experimentRequest:e})}new v(this.state.experimentRequest).getAnalyticsAssessment().then((e=>{const t=JSON.parse(JSON.parse(e));console.log(t),this.getWinAnalysis(t),this.getWinProbAndBasicStats(t),this.getAlgo(t);const s=this.getTrafficRecs(this.state.selectedAlgo,t);this.setState({haveResults:!0,experimentResult:t,trafficSplit:s,haveAdvancedStatistics:this.haveAdvancedStatistics(),haveCriteriaComparison:this.haveCriteriaComparison(),endExperimentWinner:t.baseline_assessment.id}),this.state.haveCriteriaComparison&&this.getChartData(),this.state.haveAdvancedStatistics&&(this.createadvancedStatisticsObject(),this.getAdvancedStatistics(this.state.selectedAdvancedStatistic)),this.getdeployList()})).catch((e=>{console.log(e)}))}getdeployList(){if(0===this.deployList.length){this.deployList.push(this.state.experimentRequest.baseline.id);const e=this.state.experimentRequest.candidates;for(let t=0;t<e.length;t++)this.deployList.push(e[t].id)}}doNothing(e){"undefined"===e&&console.log("Updating")}handleReset(){const e=Array.from(this.trafficRecs);this.setState({trafficSplit:e,trafficErr:!1})}handleApply(){const e=this.state.experimentRequest.baseline.version_labels.destination_workload_namespace,t=this.state.experimentRequest.service_name,s=(0,b.hp)(e,t,this.state.trafficSplit);s.edgeService=this.state.edgeService,s.hostGateways=this.state.hostGateways,(0,b.Nq)(s,this.args);const i=(new Date).toISOString();this.setState({notifyTime:i,notifyUser:!0,currentSplit:this.state.trafficSplit})}handleCloseNotif(){this.setState({notifyUser:!1})}updateExperimentDecision(e){this.setState({experimentDecision:e});const t=this.state.experimentResult.baseline_assessment.id;if("rollback"===e)this.updateEndExperimentWinner(t);else if("rollforwardwinner"===e){const e=this.state.experimentResult.winner_assessment.winning_version_found?this.state.experimentResult.winner_assessment.current_best_version:t;this.updateEndExperimentWinner(e)}}updateEndExperimentWinner(e){this.setState({endExperimentWinner:e})}endExperiment(){const e=this.state.trafficSplit;for(let t=0;t<e.length;t++)e[t].version===this.state.endExperimentWinner?e[t].split=100:e[t].split=0;this.setState({trafficSplit:e,hasExperimentEnded:!0}),this.handleApply()}render(){++this.notifKey;const{trafficSplit:e}=this.state;return i.createElement(p.Form,{className:"plugin-iter8-formProps"},i.createElement(p.FormGroup,{fieldId:"decisionForm-id-1"},i.createElement(n.gb,{description:this.state.experimentCreated?"Experiment Created: ":"Waiting for iter8 Experiment to be created..."})),this.state.haveResults?i.createElement("div",null,i.createElement(p.FormGroup,{fieldId:"decisionForm-id-2"},i.createElement("h4",{className:"titletexts"}," Winner Assessments "),this.state.experimentResult.winner_assessment.winning_version_found?i.createElement("div",null,i.createElement("h4",{className:"green"},"Winner Found!"),i.createElement("h5",{className:"green"}," ",this.winner," ")):i.createElement("div",null,i.createElement("h4",{className:"red"},this.winner))),i.createElement(p.FormGroup,{fieldId:"decisionForm-id-3"},i.createElement("h4",{className:"titletexts"}," High Level Overview "),i.createElement(m.X,null,_({headers:this.basicStatsRows,rows:this.basicStatsHeader,title:"",id:"basic",params:{}}))),i.createElement(p.FormGroup,{fieldId:"decisionForm-id-4"},i.createElement(n.zx,{size:"default",kind:"primary",isDisabled:!this.state.experimentCreated||this.state.hasExperimentEnded,onClick:this.handleGetAssessment},"Get Assessment")),i.createElement(p.FormGroup,{fieldId:"decisionForm-id-5",label:"Traffic Routing Goal","aria-label":"Routing Goal Unavailable",helperText:"Choose your traffic routing goal"},i.createElement("h4",{className:"titletexts"}," Traffic Assessments "),i.createElement(p.FormSelect,{id:"analyticsAlgo",onChange:e=>this.handleAlgoChange(e)},this.algoList.map(((e,t)=>i.createElement(p.FormSelectOption,{key:t,label:e?e.text:""})))),i.createElement("div",null,i.createElement(n.zx,{size:"default",kind:"danger",onClick:this.handleReset},"Reset Traffic"),i.createElement(n.zx,{size:"default",kind:"primary",onClick:this.handleApply,isDisabled:this.state.trafficErr||this.state.hasExperimentEnded},"Apply Traffic Split")),this.state.notifyUser?i.createElement(n.bZ,{isGlobal:!0,key:this.notifKey,alert:{type:"success",title:"Virtual Service & Destination Rule Created",body:"Traffic is being re-routed. Allow a few seconds for changes to be implemented."},onCloseButtonClick:this.handleCloseNotif}):null),this.state.currentSplit.length>0?i.createElement(p.FormGroup,{className:"currenttraffic",fieldId:"decisionForm-id-6"},i.createElement("p",null," Current Traffic Split: "),this.state.currentSplit.map(((e,t)=>{const s=`${t}=${e.split}`;return i.createElement("p",{key:s}," ",e.version," : ",e.split," ")}))):null,e.map(((e,t)=>{const s=`${t}=${e.split}`;return i.createElement(p.FormGroup,{key:t,fieldId:`decisionForm-id-7-${t}`,label:e.version},i.createElement(p.TextInput,{key:s,value:e.split,onChange:t=>this.handleTrafficChange(parseInt(t,10),e.version)}))})),this.state.trafficErr?i.createElement(n.bZ,{alert:{type:"error",title:"Invalid Traffic Split",body:"Traffic percentages must add to 100%"},hideCloseButton:!0}):null,i.createElement(p.FormGroup,{fieldId:"decisionForm-id-8"},i.createElement("h4",{className:"titletexts"}," Criteria Assessments "),this.state.haveCriteriaComparison?i.createElement("div",null,this.state.chartData.map((e=>i.createElement("div",{key:e.title+":div"},i.createElement("h5",{key:e.title+":h5",className:"titletexts"}," ",e.title," "),i.createElement(S,{key:e.title+":Chart",type:"line",options:this.state.chartOptions[e.title],series:e.data,width:"400"}))))):i.createElement("h4",null," No Criteria Assessment to show")),i.createElement(p.FormGroup,{className:"advancedstats",fieldId:"decisionForm-id-9"},i.createElement("h4",{onClick:this.toggleAdvancedStatistics},"Advanced Statistics"," ",i.createElement("sup",null,i.createElement(n.PJ,{icon:"Help"})," ",i.createElement("div",null," Advanced Statistics is only available for Ratio Metrics ")," "))),this.state.showAdvancedStatistics&&this.state.haveAdvancedStatistics?i.createElement(p.FormGroup,{fieldId:"decisionForm-id-10",label:"Advanced Statistics","aria-label":"Advanced Statistics Unavailable",helperText:"Choose a statistic to compare"},i.createElement(p.FormSelect,{id:"advancedStatistics",onChange:e=>this.getAdvancedStatistics(e)},Object.keys(this.advancedStatisticsNames).map(((e,t)=>i.createElement(p.FormSelectOption,{key:t,label:e})))),i.createElement(m.X,null,_({rows:this.state.advancedStatisticsRows,headers:this.advancedStatiticsHeaders,title:"Advanced Metric Assessment",id:"advanced",params:{}}))):null,this.state.showAdvancedStatistics&&!this.state.haveAdvancedStatistics?i.createElement(p.FormGroup,{fieldId:"decisionForm-id-11"},i.createElement("h4",null," No Advanced Statistics to show")):null):null,i.createElement(p.FormGroup,{fieldId:"decisionForm-id-12"},i.createElement(n.zx,{size:"default",kind:"primary",isDisabled:!this.state.experimentCreated||this.state.hasExperimentEnded,onClick:this.handleGetAssessment},"Get Assessment")),this.state.haveResults?i.createElement("div",null,i.createElement("h4",{className:"titletexts"}," End Experiment "),i.createElement(p.FormGroup,{fieldId:"decisionForm-id-13",label:"End the Experiment by choosing to roll back traffic to baseline or roll forward traffic to winner"},i.createElement(p.FormSelect,{name:"end-experiment",onChange:e=>this.updateExperimentDecision(e),className:"pad10"},i.createElement(p.FormSelectOption,{id:"rollback",label:"Roll Back to Baseline",value:"rollback"}),i.createElement(p.FormSelectOption,{id:"rollforwardwinner",label:"Roll Forward to Winner",value:"rollforwardwinner"}),i.createElement(p.FormSelectOption,{id:"rollforwardother",label:"Roll Forward to Another Deployment",value:"rollforwardother"}))),"rollforwardother"===this.state.experimentDecision?i.createElement(p.FormGroup,{fieldId:"decisionForm-id-13b",helperText:"Select the winner of the experiment"},i.createElement(p.FormSelect,{id:"winner-select",placeholder:"Select",onChange:e=>this.updateEndExperimentWinner(e)},this.deployList.map(((e,t)=>i.createElement(p.FormSelectOption,{key:t,label:e}))))):null,i.createElement(p.FormGroup,{className:"endexpbtn",fieldId:"decisionForm-id-14"},i.createElement(n.zx,{size:"default",kind:"primary",onClick:this.endExperiment,isDisabled:this.state.hasExperimentEnded},"End Experiment"))):null)}}},54329:(e,t,s)=>{"use strict";var i;s.d(t,{K:()=>i,t:()=>a}),function(e){e.hil="Human In the Loop",e.automated="Automated"}(i||(i={}));const a={chart:{type:"line",stacked:!1,height:350,zoom:{type:"x",enabled:!0,autoScaleYaxis:!0},toolbar:{autoSelected:"zoom"}},stroke:{width:2,curve:"straight",dashArray:[9]},dataLabels:{enabled:!1},markers:{size:3},title:{text:"",align:"left"},yaxis:{labels:{formatter:function(e){return(e/1e6).toFixed(0)}}},xaxis:{type:"datetime",categories:[],labels:{datetimeFormatter:{year:"yyyy",month:"MMM 'yy",day:"dd MMM",hour:"HH:mm"}}},tooltip:{shared:!1,y:{formatter:function(e){return(e/1e6).toFixed(0)}}}}}}]);